<!DOCTYPE html>

<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>é«˜ç«¯å¤§æ°”çš„ä¼ä¸šç½‘ç«™é¡µé¢æ¨¡æ¿æºç  - ä»£ç åº“</title>
<meta content="" name="Keywords"/>
<meta content="" name="Description"/>
<link href="css/css.css" rel="stylesheet" type="text/css"/>
<script src="js/jquery-min-1.7.js" type="text/javascript"></script>
<script src="js/DD_belatedPNG.js" type="text/javascript"></script>
<script src="js/jquery.kinMaxShow-1.0.min.js" type="text/javascript"></script>
<script src="js/js.js" type="text/javascript"></script>
<script src="js/jquery.form.js" type="text/javascript"></script>
<script src="js/utils.js" type="text/javascript"></script>
<script src="js/validator.js" type="text/javascript"></script>
<script src="js/jquery.cookies.js" type="text/javascript"></script>
<script>
    $(function () {
        if (jQuery.cookie("the_cookie") != "the_value") {
            $(".mengban").show();
            $(".mengban").click(function () {
                $(".mengban").hide();
                jQuery.cookie('the_cookie', 'the_value', { expires: 1, path: '/' });
            })
        }
    })

    $(window).scroll(function () {
        if ($(window).scrollTop() > 0) {
            $(".mengban").hide();
        }
    });
			
</script>
<style>
.mengban{ background:#000; width:100%; height:100%; position:fixed; z-index:99999999;filter:alpha(opacity=90);opacity:0.9}
.mengban .mengban1{ position:absolute; top:20px; left:5%}
.mengban .mengban2{ position:absolute; top:0px; right:5%}
.mengban .mengban3{ position:absolute; top:92px; left:5%}
.mengban .mengban4{ position:absolute; top:92px; right:5%}
</style>

<style id="editor-styles">
/* ç¼–è¾‘å™¨æŒ‰é’®æ ·å¼ */
.editor-button {
  position: fixed;
  bottom: 20px;
  z-index: 10000;
  padding: 10px 15px;
  background-color: #4285f4;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  font-size: 14px;
  font-weight: bold;
  transition: background-color 0.2s;
}

/* å…ƒç´ é«˜äº®æ ·å¼ */
.element-highlight {
  position: absolute;
  z-index: 9999;
  pointer-events: none;
  border: 2px solid #ea4335;
  background-color: rgba(234, 67, 53, 0.1);
  box-sizing: border-box;
}

/* å…ƒç´ æ£€æŸ¥å™¨æ ·å¼ */
#elementInspector {
  position: fixed;
  display: none;
  z-index: 10000;
  padding: 10px 15px;
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  font-size: 12px;
  max-width: 300px;
  word-break: break-all;
}

/* ç¼–è¾‘æŒ‰é’®å®¹å™¨ */
#divEditorButtons {
  position: absolute;
  display: none;
  z-index: 10000;
  gap: 5px;
}

/* ç¼–è¾‘æŒ‰é’®æ ·å¼ */
#editDuplicateBtn {
  padding: 0 !important;
  background-color: #34a853 !important;
  color: white !important;
  font-weight: bold !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 36px !important;
  height: 36px !important;
  text-align: center !important;
  font-size: 20px !important;
  border-radius: 4px !important;
  margin: 0 4px !important;
  border: none !important;
}

#editRemoveBtn {
  padding: 0 !important;
  background-color: #ea4335 !important;
  color: white !important;
  font-weight: bold !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 36px !important;
  height: 36px !important;
  text-align: center !important;
  font-size: 20px !important;
  border-radius: 4px !important;
  margin: 0 4px !important;
  border: none !important;
}

/* é€‰ä¸­çš„divå…ƒç´ æ ·å¼ */
.div-selected {
  outline: 2px dashed #4285f4 !important;
  outline-offset: 1px !important;
  position: relative;
}

/* æ–‡æœ¬å’Œå›¾ç‰‡ç¼–è¾‘æ ·å¼ - å®Œå…¨ä¸å½±å“å¸ƒå±€çš„ç‰ˆæœ¬ */
.text-editable:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  outline: 1px dashed #34a853;
  pointer-events: none;
  z-index: 9998;
}

.text-editable:hover:after {
  background-color: rgba(52, 168, 83, 0.1);
}

.text-editable:focus:after {
  outline: 1px solid #34a853;
  background-color: rgba(52, 168, 83, 0.05);
}

.text-editable {
  cursor: text !important;
}

.image-editable:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  outline: 2px dashed #fbbc05;
  pointer-events: none;
  z-index: 9998;
}

.image-editable:hover:after {
  background-color: rgba(251, 188, 5, 0.1);
}

.image-editable {
  cursor: pointer !important;
}

/* å¸¦æœ‰èƒŒæ™¯å›¾çš„å¯ç¼–è¾‘å…ƒç´ æ ·å¼ */
.bg-image-editable:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  outline: 2px dashed #fbbc05;
  pointer-events: none;
  z-index: 9998;
}

.bg-image-editable:hover:after {
  background-color: rgba(251, 188, 5, 0.1);
}

.bg-image-editable:before {
  content: "ğŸ–¼ï¸";
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: rgba(251, 188, 5, 0.8);
  color: #333;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 12px;
  z-index: 9999;
  pointer-events: none;
}

.bg-image-editable {
  cursor: pointer !important;
}

/* è½®æ’­å›¾å®¹å™¨æ ·å¼ */
.carousel-container-editable:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  outline: 2px dashed #4285f4;
  pointer-events: none;
  z-index: 9998;
}

.carousel-container-editable:hover:after {
  background-color: rgba(66, 133, 244, 0.1);
}

.carousel-container-editable:before {
  content: "ğŸï¸";
  position: absolute;
  top: 5px;
  right: 5px;
  background-color: rgba(66, 133, 244, 0.8);
  color: white;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 12px;
  z-index: 9999;
  pointer-events: none;
}

.carousel-container-editable {
  cursor: pointer !important;
}

/* å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†æ ·å¼ */
#imageUploadModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10001;
}

.modal-content {
  background-color: #fff;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
}

.modal-title {
  margin-top: 0;
  color: #333;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  margin-top: 20px;
  gap: 10px;
}

.modal-button {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

#cancelImageUpload {
  background-color: #f2f2f2;
  color: #333;
}

#applyImageUpload {
  background-color: #4285f4;
  color: #fff;
}

#imagePreview {
  margin-top: 15px;
  text-align: center;
}

#imagePreview img {
  max-width: 100%;
  max-height: 300px;
  border: 1px solid #ddd;
}
</style>
</head>
<!--/************************************************************
 *																*
 * 						      ä»£ç åº“							*
 *                        www.dmaku.com							*
 *       		  åŠªåŠ›åˆ›å»ºå®Œå–„ã€æŒç»­æ›´æ–°æ’ä»¶ä»¥åŠæ¨¡æ¿			*
 * 																*
**************************************************************-->
<body>
<div class="mengban" style="display:none">
<div class="mengban1"><img height="21" src="images/meng3.png" width="148"/></div>
<div class="mengban2"><img height="56" src="images/meng4.png" width="154"/></div>
<div class="mengban3"><img height="270" src="images/meng1.png" width="290"/></div>
<div class="mengban4"><img height="282" src="images/meng2.png" width="301"/></div>
</div>
<div class="top">
<div class="top_a">
<div class="logo_a"><a href="index.html"><img alt="AIç åœº" height="21" src="images/AIç åœº.png" style="width: auto;"/></a></div>
<div class="top_aa">AIç åœº</div>
</div>
<div class="top_b">
<a class="top_bb" href="javascript:;"></a>
<div class="aaa_cz">
<div class="xj_nav">
<a href="è§£å†³æ–¹æ¡ˆ.html">è§£å†³æ–¹æ¡ˆ</a>
<a href="æœåŠ¡ä¸“åŒº.html">æœåŠ¡ä¸“åŒº</a>
<a href="çŸ¥è¯†å­¦é™¢.html">çŸ¥è¯†å­¦é™¢</a>
<a href="æ¡ˆä¾‹ä¸­å¿ƒ.html">å®¢æˆ·æ¡ˆä¾‹</a>
<a href="äº§å“ä¸­å¿ƒ.html">äº§å“ä¸­å¿ƒ</a>
</div>
</div>
<div class="top_ba">Memu</div>
</div>
</div>
<div class="banner">
<div class="intro" id="mangoShow">
<div class="wrap clearFix">
<div class="cz_bannn" style="background:url(images/banner_aa.jpg) no-repeat center top #ffa800">
</div>
<div>
<img class="sub_1_1" src="images/cz_ban_a.png"/>
<img class="sub_1_2" src="images/cz_ban_b.png"/>
<img class="sub_1_3" src="images/cz_ban_c.png"/>
<img class="sub_1_4" src="images/cz_ban_d.png"/>
<a href="javascript:;scheme/"><img class="sub_1_5" src="images/czx1.png"/></a>
</div>
</div>
<div class="wrap clearFix">
<div class="cz_bannn" style="background:url(images/banner_bbb.png) no-repeat center top ">
</div>
<div>
<img class="sub_2_1" src="images/czym_ccc.png"/>
<img class="sub_2_2" src="images/czym_bbb.png"/>
<a href="javascript:;a/zhishixueyuan/"><img class="sub_2_3" src="images/czym_aaa.png"/></a>
</div>
</div>
<div class="wrap clearFix">
<div class="cz_bannn" style="background:url(images/czym_ddd.png) no-repeat center top ">
</div>
<div>
<img class="sub_3_1" src="images/czym_eee.png"/>
<img class="sub_3_2" src="images/czyu_ccc.png"/>
<a href="javascript:;a/yinxiao"><img class="sub_3_3" src="images/czym_aaa.png"/></a>
</div>
</div>
</div>
</div>
<div class="main_a">
<div class="main">
<div class="main_aa">
<div class="img"><img alt="" src="images/main_a.jpg"/></div>
<div class="text a">
<p>å…³äºæŸæŸ</p>
                    ç½‘ç»œè¥é”€é¢†åŸŸä»ä¸šè¶…è¿‡10å¹´ï¼
æˆ‘ä»¬äº†è§£å¤§ä¸­å°å‹ä¼ä¸šçš„ç”Ÿæ„æ¨¡å¼ï¼Œéœ€æ±‚ï¼Œæˆ‘ä»¬å€¡å¯¼è®©å®¢æˆ·æ„ŸçŸ¥äº§å“çš„åº”ç”¨ä½“éªŒä»·å€¼ï¼Œè€Œä¸ä»…æ˜¯äº§å“çš„åŠŸèƒ½ã€‚
                </div>
</div>
<div class="main_ab">
<div class="main_ab_ul">
<div class="main_ab_li a">
<a href="javascript:;a/wangluoyingxiaowaibao/" title="ç½‘ç»œè¥é”€å¤–åŒ…"><img alt="ç½‘ç»œè¥é”€å¤–åŒ…" src=" images/main_ba.png"/></a>
</div>
<div class="text">
<p>ç½‘ç»œè¥é”€å¤–åŒ…</p>
                        Network Marketing Service
                    </div>
</div>
<div class="main_ab_ul">
<div class="main_ab_li a">
<a href="javascript:;a/qiyeshangcheng/" title="ä¼ä¸šå•†åŸ"><img alt="ä¼ä¸šå•†åŸ" src=" images/main_bb.png"/></a>
</div>
<div class="text">
<p>ä¼ä¸šå•†åŸ</p>
                        Enterprise mall
                    </div>
</div>
<div class="main_ab_ul">
<div class="main_ab_li b">
<a href="javascript:;a/yidonghulianwangdingzhi/" title="ç§»åŠ¨äº’è”ç½‘å®šåˆ¶"><img alt="ç§»åŠ¨äº’è”ç½‘å®šåˆ¶" src=" images/main_bc.png"/></a>
</div>
<div class="text">
<p>ç§»åŠ¨äº’è”ç½‘å®šåˆ¶</p>
                        Mobile Internet
                    </div>
</div>
<div class="main_ab_ul">
<div class="main_ab_li a">
<a href="javascript:;a/yinxiao/" title="å…¨ç½‘è¥é”€"><img alt="å…¨ç½‘è¥é”€" src=" images/main_bd.png"/></a>
</div>
<div class="text">
<p>å…¨ç½‘è¥é”€</p>
                        Internet Marketing
                    </div>
</div>
</div>
</div>
</div>
<div class="main_b">
<div class="main">
<div class="main_aa">
<div class="img"><img alt="" src="images/main_c.jpg"/></div>
<div class="text b">
<p>æ¡ˆä¾‹å±•ç¤º</p>
                    ç½‘ç»œè¥é”€é¢†åŸŸä»ä¸šè¶…è¿‡10å¹´ï¼
æˆ‘ä»¬äº†è§£å¤§ä¸­å°å‹ä¼ä¸šçš„ç”Ÿæ„æ¨¡å¼ï¼Œéœ€æ±‚ï¼Œæˆ‘ä»¬å€¡å¯¼è®©å®¢æˆ·æ„ŸçŸ¥äº§å“çš„åº”ç”¨ä½“éªŒä»·å€¼ï¼Œè€Œä¸ä»…æ˜¯äº§å“çš„åŠŸèƒ½ã€‚
                </div>
</div>
<div class="main_b_c">
<div class="case_a_cont">
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0M002UP-c506.jpg" width="238"/>
<p>
<span>æ·±åœ³å¸‚æ‹“ç’å®¶å…·è®¾è®¡æœ‰é™</span>
<font>æ·±åœ³å¸‚æ‹“ç’å®¶å…·è®¾è®¡æœ‰é™...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0LW0SF-955W.jpg" width="238"/>
<p>
<span>ã€ŠLet''''''''s blink æˆ‘å”±æˆ‘é—ª</span>
<font>blinkå†°åŠ›å…‹ï¼Œæ¥è‡ªå¾·å›½çš„æ— ...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0Lb42410-J143.jpg" width="238"/>
<p>
<span>æ–°åŠ›æ–‡å…·</span>
<font>...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0L95521F-41M2.jpg" width="238"/>
<p>
<span>å¹¿ä¸œä¿åŠè‰ºæœ¯å“æœ‰é™å…¬å¸</span>
<font>...</font>
</p>
<b></b>
</a>
</div><div class="case_a_cont">
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0L93Y630-26116.jpg" width="238"/>
<p>
<span>åŒ—ç”µä¸°å´</span>
<font>...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0L910JP-13SZ.jpg" width="238"/>
<p>
<span>å¤šå°”èµ›ç‰¹é—¨ä¸š</span>
<font>...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0LY3b40-11Q54.jpg" width="238"/>
<p>
<span>Nice May</span>
<font>...</font>
</p>
<b></b>
</a>
<a href="javascript:;" target="_blank">
<img height="166" src="images/140U0LS53230-4b38.jpg" width="238"/>
<p>
<span>ä»™è·¯ç å®</span>
<font>...</font>
</p>
<b></b>
</a>
</div>
<div class="case_a_cont">
</div>
<div class="more main_d_c cz">
<a class="png" href="javascript:;cases/">MORE</a>
</div>
</div>
</div>
</div>
<div class="main_c">
<div class="main">
<div class="main_aa">
<div class="img"><img alt="" src="images/main_a.jpg"/></div>
<div class="text a">
<p>èµ„è®¯ä¸­å¿ƒ</p>
                     æŠ€è‰ºæ˜¯æ— ä»·ä¹‹å®ï¼ŒçŸ¥è¯†æ˜¯æ™ºæ…§çš„æ˜ç¯ï¼Œæ²¡æœ‰æ¯”çŸ¥è¯†æ›´å¥½çš„æœ‹å‹ã€‚
                </div>
</div>
<div class="main_c_c">
<ul>
<li>
<div class="main_c_ct">è¥é”€å‹ç½‘ç«™å»ºè®¾</div>
<div class="main_c_cc">
<a href="javascript:;" title="ç½‘ç»œæ–°é—»æ˜¯å“ç‰Œä¹‹é­‚"><b>+</b>ç½‘ç»œæ–°é—»æ˜¯å“ç‰Œä¹‹é­‚</a>
<a href="javascript:;" title="ç½‘ç»œè¥é”€--ä¼ é€’å“ç‰Œä»·å€¼"><b>+</b>ç½‘ç»œè¥é”€--ä¼ é€’å“ç‰Œä»·å€¼</a>
<a href="javascript:;" title="ä¼ ç»Ÿè¡Œä¸šçš„äº’è”ç½‘æ€ç»´è¯¯"><b>+</b>ä¼ ç»Ÿè¡Œä¸šçš„äº’è”ç½‘æ€ç»´è¯¯</a>
<a href="javascript:;" title="æµ…è°ˆå•†ä¸šåœ°äº§äº’è”ç½‘æ€ç»´"><b>+</b>æµ…è°ˆå•†ä¸šåœ°äº§äº’è”ç½‘æ€ç»´</a>
<a href="javascript:;" title="ç”¨äº’è”ç½‘æ€ç»´é¢ è¦†ä¸‡ç§‘ï¼š"><b>+</b>ç”¨äº’è”ç½‘æ€ç»´é¢ è¦†ä¸‡ç§‘ï¼š</a>
<a class="more" href="javascript:;a/yingxiaoxingwangzhanjianshe/">MORE</a>
</div>
</li>
<li>
<div class="main_c_ct">ç½‘ç»œè¥é”€çŸ¥è¯†</div>
<div class="main_c_cc">
<a href="javascript:;" title="å…³é”®è¯é€‰å–æ­¥éª¤"><b>+</b>å…³é”®è¯é€‰å–æ­¥éª¤</a>
<a href="javascript:;" title="SEOçš„åŸºæœ¬æ­¥éª¤"><b>+</b>SEOçš„åŸºæœ¬æ­¥éª¤</a>
<a href="javascript:;" title="æ€æ ·åšç½‘ç»œè¥é”€çš„å·®å¼‚åŒ–"><b>+</b>æ€æ ·åšç½‘ç»œè¥é”€çš„å·®å¼‚åŒ–</a>
<a href="javascript:;" title="è€æ¿ä¸æ­£ç¡®çš„æ€æƒ³è§‚å¿µï¼Ÿ"><b>+</b>è€æ¿ä¸æ­£ç¡®çš„æ€æƒ³è§‚å¿µï¼Ÿ</a>
<a href="javascript:;" title="ä¼ä¸šä¸ºä»€ä¹ˆè¦åšç½‘ç»œè¥é”€"><b>+</b>ä¼ä¸šä¸ºä»€ä¹ˆè¦åšç½‘ç»œè¥é”€</a>
<a class="more" href="javascript:;a/yidonghulianwangyingxiao/">MORE</a>
</div>
</li>
<li>
<div class="main_c_ct">å…¬å¸å…¬å‘Š</div>
<div class="main_c_cc">
<a href="javascript:;" title="ç½‘ç»œè¥é”€---è®©çŒªé£èµ·æ¥"><b>+</b>ç½‘ç»œè¥é”€---è®©çŒªé£èµ·æ¥</a>
<a href="javascript:;" title="ç½‘ç»œè¥é”€æ¨å¹¿ç‰¹è‰²"><b>+</b>ç½‘ç»œè¥é”€æ¨å¹¿ç‰¹è‰²</a>
<a href="javascript:;" title="æ–°é—»å†…å®¹ä¸€å®šè¦æœ‰å†²å‡»åŠ›"><b>+</b>æ–°é—»å†…å®¹ä¸€å®šè¦æœ‰å†²å‡»åŠ›</a>
<a href="javascript:;" title="ä¼ä¸šå¦‚ä½•å€ŸåŠ©ç§»åŠ¨äº’è”ç½‘"><b>+</b>ä¼ä¸šå¦‚ä½•å€ŸåŠ©ç§»åŠ¨äº’è”ç½‘</a>
<a href="javascript:;" title="è¥é”€å‹ç½‘ç«™æ€ä¹ˆåš?"><b>+</b>è¥é”€å‹ç½‘ç«™æ€ä¹ˆåš?</a>
<a class="more" href="javascript:;a/gongsigonggao/">MORE</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="main_d">
<form action="javascript:;" enctype="multipart/form-data" id="reviewForm" method="post" name="reviewForm" onsubmit="return Insertfeedbook(this,'reviewForm')">
<input name="action" type="hidden" value="post"/>
<input name="diyid" type="hidden" value="1"/>
<input name="do" type="hidden" value="2"/>
<div class="main_d_a"></div>
<div class="main_d_b">
<ul>
<li>
<div class="main_d_b_l a"></div>
<div class="main_d_b_r a">
<input class="txt" id="name" name="name" type="text" value="å°Šç§°"/>
</div>
</li>
<li>
<div class="main_d_b_l a"></div>
<div class="main_d_b_r a">
<input class="text" id="tel" name="tel" type="text" value="ç”µè¯"/>
</div>
</li>
<li>
<div class="main_d_b_l a"></div>
<div class="main_d_b_r a">
<input class="txt" id="email" name="email" type="text" value="é‚®ç®±"/>
</div>
</li>
<li>
<div class="main_d_b_l b"></div>
<div class="main_d_b_r b">
<textarea id="content" name="content">æ‚¨çš„è¦æ±‚</textarea>
</div>
</li>
</ul>
</div>
<div class="main_d_c"><input name="dede_fields" type="hidden" value="name,text;tel,text;email,text;content,multitext"/>
<input name="dede_fieldshash" type="hidden" value="6ab3473b54d46e14f8bf2aa4f4cef3fa"/>
<input class="png" name="submit" type="submit" value="æ äº¤"/></div>
</form>
</div>
<div class="main_e">
<div class="main_aa">
<div class="img"><img height="128" src="images/link_d.jpg" width="140"/></div>
<div class="text c">
                     åœ°å€/Addï¼šä¸­åäººæ°‘å…±å’Œå›½  
                     ç”µè¯/Telï¼š 86-66666666
                     é‚®ç®±/Mailï¼š <a href=" xxxx@163.com">xxxx@163.com</a>
</div>
<div class="img_a"><img height="20" src="images/link_e.jpg" width="227"/></div>
</div>
</div>
<div class="link">
<div class="main">
<ul>
<li>
<p>è§£å†³æ–¹æ¡ˆ</p>
<a href="javascript:;scheme/">ç½‘ç»œè¥é”€å¤–åŒ…</a>
<a href="javascript:;scheme/">é«˜ç«¯å“ç‰Œç½‘ç«™å»ºè®¾</a>
<a href="javascript:;scheme/">ç§»åŠ¨äº’è”ç½‘å®šåˆ¶</a>
<a href="javascript:;scheme/">å…¨ç½‘è¥é”€</a>
<a href="javascript:;scheme/">ä¼ä¸šè§†è§‰è®¾è®¡</a>
</li>
<li>
<p>æœåŠ¡ä¸“åŒº</p>
<a href="javascript:;a/yingxiaoxingwangzhanjianshe/">è¥é”€å‹ç½‘ç«™å»ºè®¾</a>
<a href="javascript:;a/yidonghulianwangyingxiao/">ç§»åŠ¨äº’è”ç½‘è¥é”€</a>
<a href="javascript:;a/wangluojichuyewu/">ç½‘ç»œåŸºç¡€ä¸šåŠ¡</a>
<a href="javascript:;a/gongsigonggao/">å…¬å¸å…¬å‘Š</a>
</li>
<li>
<p>çŸ¥è¯†å­¦é™¢</p>
<a href="javascript:;a/yingxiao_guanli/">è¥é”€â—ç®¡ç†</a>
<a href="javascript:;a/zhuanye_fenxiang/">ä¸“ä¸šâ—åˆ†äº«</a>
<a href="javascript:;a/wangluoyingxiaozhishi/">ç½‘ç»œè¥é”€çŸ¥è¯†</a>
</li>
<li>
<p>æ¡ˆä¾‹å±•ç¤º</p>
<a href="javascript:;cases/yinx/">å…¨ç½‘è¥é”€å¹³å°</a>
<a href="javascript:;cases/yiweb/">ç§»åŠ¨äº’è”ç½‘</a>
<a href="javascript:;cases/shop/">ä¼ä¸šå•†åŸ</a>
</li>
<li>
<p>äº§å“ä¸­å¿ƒ</p>
<a href="javascript:;a/yinxiao/">å…¨ç½‘è¥é”€å¹³å°</a>
<a href="javascript:;a/yidonghulianwangdingzhi/">ç§»åŠ¨äº’è”ç½‘å®šåˆ¶</a>
<a href="javascript:;a/qiyeshangcheng/">ä¼ä¸šå•†åŸ</a>
<a href="javascript:;a/wangluojichuyewu/">ç½‘ç»œåŸºç¡€ä¸šåŠ¡</a>
<a href="javascript:;a/wangluoyingxiaowaibao/">ç½‘ç»œè¥é”€å¤–åŒ…</a>
</li>
<li>
<p>æŸæŸ</p>
<a href="javascript:;abouts/lj/">äº†è§£æˆ‘ä»¬</a>
<a href="javascript:;abouts/sw/">å•†åŠ¡åˆä½œ</a>
<a href="javascript:;abouts/join/">åŠ å…¥æˆ‘ä»¬</a>
</li>
<li>
<p>è”ç³»æˆ‘ä»¬</p>
<a href="javascript:;contacts/">åœ°å›¾ä¸Šæ‰¾åˆ°æˆ‘ä»¬</a>
</li></ul>
</div>
<div class="flink">
        å‹æƒ…é“¾æ¥ï¼š
        <a href="http://www.dmaku.com" target="_blank">ä»£ç åº“</a> Â |Â <a href="http://www.dmaku.com/moban.html" target="_blank">ç½‘ç«™æ¨¡æ¿</a>
</div>
</div>
<div class="qqkefu">
<ul>
<li class="top">TOP<span></span></li>
<li class="qq_cza"><a href="javascript:;"><b class="a"></b>å’¨è¯¢</a></li>
<li class="qq_cza" id="zx"><a href="javascript:;"><b class="b"></b>åœ¨çº¿å’¨è¯¢</a></li>
<li class="qq_czb">
<b class="c"></b>
<div class="erweima">
<p><img src="images/20140417172111_3368.jpg"/> æ‰‹æœºç½‘ç«™ï¼</p>
<p><img src="images/20140417172211_5092.jpg"/> å…³æ³¨ä¼ä¸šå¾®ä¿¡</p>
<i class="arrow3"></i>
</div>
</li>
</ul>
</div>
<script>
        $(function () {
            $("#zx").click(function () {
				window.location.href = "/contacts/";
            })
            $(".qq_czlxb").hover(function () {
                $(".phone_whole").show(50);
            }, function () {
                $(".phone_whole").hide(50);
            });
        })
    </script>
<script type="text/javascript">
      $(function () {
          $("#mangoShow").kinMaxShow({
              height: 700,
              button: {
                  showIndex: false,
                  normal: { background: 'url(images/fsl_a.png) no-repeat', marginRight: '8px', border: '0', left: '50%', bottom: '0', height: '36px', width: '38px' },
                  focus: { background: 'url(images/fsl_a.jpg) no-repeat', border: '0' }
              },
              callback: function (index, action) {
                  switch (index) {
                      case 0:
                          if (action == 'fadeIn') {
                              $(this).find('.sub_1_1').animate({ top: '134px' }, 600)
                              $(this).find('.sub_1_2').animate({ bottom: '0' }, 600)
                              $(this).find('.sub_1_3').animate({ top: '357px' }, 900)
                              $(this).find('.sub_1_4').animate({ top: '260px' }, 900)
                              $(this).find('.sub_1_5').animate({ top: '358px' }, 600)

                          } else {
                              $(this).find('.sub_1_1').animate({ top: '-163px' }, 600)
                              $(this).find('.sub_1_2').animate({ bottom: '-286px' }, 600)
                              $(this).find('.sub_1_3').animate({ bottom: '-336px' }, 600)
                              $(this).find('.sub_1_4').animate({ top: '-236px' }, 600)
                              $(this).find('.sub_1_5').animate({ top: '-358px' }, 600)
                          };
                          break;

                      case 1:
                          if (action == 'fadeIn') {
                              $(this).find('.sub_2_1').animate({ left: '50%' }, 600)
                              $(this).find('.sub_2_2').animate({ left: '50%' }, 900)
                              $(this).find('.sub_2_3').animate({ top: '550px' }, 600)
                          } else {
                              $(this).find('.sub_2_1').animate({ left: '100%' }, 600)
                              $(this).find('.sub_2_2').animate({ left: '0' }, 600)
                              $(this).find('.sub_2_3').animate({ top: '550px' }, 600)
                          };
                          break;

                      case 2:
                          if (action == 'fadeIn') {
                              $(this).find('.sub_3_1').animate({ top: '115px' }, 400)
                              $(this).find('.sub_3_2').animate({ top: '400px' }, 800)
                              $(this).find('.sub_1_3').animate({ top: '306px' }, 600)
                          } else {
                              $(this).find('.sub_3_1').animate({ top: '-162px' }, 400)
                              $(this).find('.sub_3_2').animate({ bottom: '-297px' }, 800)
                              $(this).find('.sub_3_3').animate({ top: '306px' }, 600)
                          };
                          break;

                  }
              }

          });


      });


</script>
<script type="text/javascript">
    function Insertfeedbook(form, formnae) {
        $(form).ajaxSubmit({
            beforeSubmit: function () {
                var validator = new Validator(formnae);
                validator.required("name", "è¯·è¾“å…¥ç”¨æˆ·å!");
                validator.isEmail("email", "é‚®ä»¶æ ¼å¼é”™è¯¯", true);
                validator.required("content", "è¯·è¾“å…¥ç•™è¨€å†…å®¹ï¼");
                return validator.passed();
            },
           // dataType: 'script',
            resetForm: true,
            success: function (data) {
                alert("æ·»åŠ æˆåŠŸï¼");
            }
        });
        return false;
    }
</script>

<!-- å…ƒç´ æ£€æŸ¥å™¨ -->
<div id="elementInspector"></div>
<!-- åŒºåŸŸç¼–è¾‘æŒ‰é’®å®¹å™¨ -->
<div id="divEditorButtons">
<button id="editDuplicateBtn" style="font-size: 20px; font-weight: bold; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; padding: 0; background-color: #34a853; color: white; border: none;">+</button>
<button id="editRemoveBtn" style="font-size: 20px; font-weight: bold; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; padding: 0; background-color: #ea4335; color: white; border: none;">-</button>
</div>
<!-- å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡† -->
<div id="imageUploadModal">
<div class="modal-content">
<h3 class="modal-title">ä¸Šä¼ æ–°å›¾ç‰‡</h3>
<p id="imageUploadDescription">é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ æ›¿æ¢å½“å‰å›¾ç‰‡ã€‚</p>
<div id="uploadTypeToggle" style="margin-bottom: 15px; display: none;">
<label><input checked="" name="uploadType" type="radio" value="single"/> å•å¼ ä¸Šä¼ </label>
<label style="margin-left: 15px;"><input name="uploadType" type="radio" value="multiple"/> å¤šå¼ ä¸Šä¼ (è½®æ’­)</label>
</div>
<input accept="image/*" id="imageFileInput" type="file"/>
<input accept="image/*" id="multipleImageFileInput" multiple="" style="display: none;" type="file"/>
<div id="imagePreview"></div>
<div id="multipleImagePreview" style="display: none; margin-top: 15px;"></div>
<div class="modal-buttons">
<button class="modal-button" id="cancelImageUpload">å–æ¶ˆ</button>
<button class="modal-button" id="applyImageUpload">åº”ç”¨</button>
</div>
</div>
</div>

<script id="editor-script">
// å…¨å±€å…±äº«å˜é‡
window.editorVars = {
  isTextEditMode: false,
  isImageEditMode: false,
  isInspecting: false,
  isEditMode: false,
  editedTextElements: {},
  editedImages: {},
  editedBackgroundImages: {},
  editedCarouselImages: {},
  currentEditingImage: null,
  currentEditingElement: null,
  currentEditingType: 'single', // 'single', 'background', 'carousel', 'container'
  selectedElement: null,
  hoverElement: null,
  hoveredHighlight: null,
  highlightElement: null,
  uploadedMultipleImages: [],
  containerImages: [], // å­˜å‚¨å®¹å™¨å†…çš„æ‰€æœ‰å›¾ç‰‡
  selectedImageIndex: -1, // å½“å‰é€‰ä¸­çš„å›¾ç‰‡ç´¢å¼•
  selectedSingleFile: null, // å­˜å‚¨å•ä¸ªé€‰æ‹©çš„æ–‡ä»¶
  selectedMultipleFiles: null, // å­˜å‚¨å¤šä¸ªé€‰æ‹©çš„æ–‡ä»¶
  buttons: null // å­˜å‚¨ç¼–è¾‘å™¨æŒ‰é’®å¼•ç”¨
};

// è·å–å…ƒç´ è·¯å¾„çš„å‡½æ•°
function getElementPath(element) {
  if (!element) return '';
  
  let path = [];
  let current = element;
  
  while (current && current !== document.documentElement) {
    let selector = current.tagName.toLowerCase();
    
    if (current.id) {
      selector += '#' + current.id;
    } else {
      // è·å–å…ƒç´ åœ¨å…¶çˆ¶å…ƒç´ ä¸­çš„ç´¢å¼•
      let index = 0;
      let sibling = current;
      while (sibling) {
        if (sibling.tagName === current.tagName) {
          index++;
        }
        sibling = sibling.previousElementSibling;
      }
      selector += `:nth-of-type(${index})`;
    }
    
    path.unshift(selector);
    current = current.parentElement;
  }
  
  return path.join(' > ');
}

// ä¿å­˜é¡µé¢çŠ¶æ€å‡½æ•°
function savePageState() {
  localStorage.setItem('pageLastModified', new Date().getTime().toString());
}

// æ·»åŠ ç¼–è¾‘å™¨æŒ‰é’®
function addEditorButtons() {
  // æ–‡æœ¬ç¼–è¾‘æŒ‰é’®
  const toggleTextEditButton = document.createElement('button');
  toggleTextEditButton.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
  toggleTextEditButton.className = 'editor-button';
  toggleTextEditButton.style.right = '350px';
  document.body.appendChild(toggleTextEditButton);
  
  // å›¾ç‰‡ç¼–è¾‘æŒ‰é’®
  const toggleImageEditButton = document.createElement('button');
  toggleImageEditButton.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
  toggleImageEditButton.className = 'editor-button';
  toggleImageEditButton.style.right = '580px';
  document.body.appendChild(toggleImageEditButton);
  
  // åŒºåŸŸç¼–è¾‘æŒ‰é’®
  const toggleEditButton = document.createElement('button');
  toggleEditButton.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
  toggleEditButton.className = 'editor-button';
  toggleEditButton.style.right = '180px';
  document.body.appendChild(toggleEditButton);
  
  // å…ƒç´ æ£€æŸ¥æŒ‰é’®
  const toggleInspectButton = document.createElement('button');
  toggleInspectButton.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
  toggleInspectButton.className = 'editor-button';
  toggleInspectButton.style.right = '30px';
  document.body.appendChild(toggleInspectButton);
  
  return {
    textEditBtn: toggleTextEditButton,
    imageEditBtn: toggleImageEditButton,
    editBtn: toggleEditButton,
    inspectBtn: toggleInspectButton
  };
}

// åˆå§‹åŒ–ç¼–è¾‘å™¨åŠŸèƒ½
function initEditor() {
  console.log('[DEBUG] å¼€å§‹åˆå§‹åŒ–ç¼–è¾‘å™¨');
  const v = window.editorVars;
  console.log('[DEBUG] ç¼–è¾‘å™¨å˜é‡çŠ¶æ€:', JSON.stringify({
    isTextEditMode: v.isTextEditMode,
    isImageEditMode: v.isImageEditMode,
    isInspecting: v.isInspecting,
    isEditMode: v.isEditMode
  }));
  
  // è·å–DOMå…ƒç´ 
  const inspector = document.getElementById('elementInspector');
  const editorButtons = document.getElementById('divEditorButtons');
  const duplicateBtn = document.getElementById('editDuplicateBtn');
  const removeBtn = document.getElementById('editRemoveBtn');
  const imageUploadModal = document.getElementById('imageUploadModal');
  const imageFileInput = document.getElementById('imageFileInput');
  const imagePreview = document.getElementById('imagePreview');
  const cancelImageUploadBtn = document.getElementById('cancelImageUpload');
  const applyImageUploadBtn = document.getElementById('applyImageUpload');
  
  console.log('[DEBUG] DOMå…ƒç´ åŠ è½½çŠ¶æ€:', {
    inspector: !!inspector,
    editorButtons: !!editorButtons,
    duplicateBtn: !!duplicateBtn,
    removeBtn: !!removeBtn,
    imageUploadModal: !!imageUploadModal
  });
  
  // æ·»åŠ ç¼–è¾‘å™¨æŒ‰é’®
  const buttons = addEditorButtons();
  // ä¿å­˜æŒ‰é’®åˆ°å…¨å±€å˜é‡
  v.buttons = buttons;
  
  console.log('[DEBUG] ç¼–è¾‘å™¨æŒ‰é’®åˆ›å»º:', {
    textEditBtn: !!buttons.textEditBtn,
    imageEditBtn: !!buttons.imageEditBtn,
    editBtn: !!buttons.editBtn,
    inspectBtn: !!buttons.inspectBtn
  });
  
  // åˆå§‹åŒ–é«˜äº®å…ƒç´ 
  ensureHighlightElementsCreated();
  
  // ç»‘å®šæŒ‰é’®äº‹ä»¶
  bindButtonEvents();
  
  // ç¡®ä¿å¤åˆ¶å’Œåˆ é™¤æŒ‰é’®æ–‡æœ¬æ˜¾ç¤ºæ­£ç¡®
  function fixActionButtons() {
    if (duplicateBtn) {
      duplicateBtn.innerHTML = '+';
      duplicateBtn.style.fontSize = '20px';
      duplicateBtn.style.backgroundColor = '#34a853';
      duplicateBtn.style.color = 'white';
    }
    
    if (removeBtn) {
      removeBtn.innerHTML = '-';
      removeBtn.style.fontSize = '20px';
      removeBtn.style.backgroundColor = '#ea4335';
      removeBtn.style.color = 'white';
    }
  }
  
  // å®šæœŸæ‰§è¡Œç¡®ä¿æŒ‰é’®æ˜¾ç¤ºæ­£ç¡®
  fixActionButtons();
  setInterval(fixActionButtons, 500);
  
  // å¤åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  duplicateBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    if (v.selectedElement) {
      duplicateElement(v.selectedElement);
    }
  });
  
  // åˆ é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
  removeBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    if (v.selectedElement) {
      removeElement(v.selectedElement);
    }
  });
  
  // é˜»æ­¢ç¼–è¾‘æŒ‰é’®å†’æ³¡
  editorButtons.addEventListener('click', function(e) {
    e.stopPropagation();
  });
  
  // åœ¨é¡µé¢åŠ è½½æ—¶åº”ç”¨ä¿å­˜çš„ä¿®æ”¹
  document.addEventListener('DOMContentLoaded', function() {
    console.log('[DEBUG] DOMå†…å®¹åŠ è½½å®Œæˆ');
    setTimeout(() => {
      console.log('[DEBUG] å¼€å§‹åº”ç”¨ä¿å­˜çš„ä¿®æ”¹');
      try {
        // åŠ è½½æ–‡æœ¬ç¼–è¾‘
        v.editedTextElements = JSON.parse(localStorage.getItem('editedTexts') || '{}');
        applyTextEdits();
        
        // åŠ è½½å›¾ç‰‡ç¼–è¾‘
        v.editedImages = JSON.parse(localStorage.getItem('editedImages') || '{}');
        v.editedBackgroundImages = JSON.parse(localStorage.getItem('editedBackgroundImages') || '{}');
        v.editedCarouselImages = JSON.parse(localStorage.getItem('editedCarouselImages') || '{}');
        applyImageEdits();
        
        // åº”ç”¨é¡µé¢ä¿®æ”¹
        applyPageModifications();
        
        // ç¡®ä¿é«˜äº®å…ƒç´ å·²åˆ›å»º
        ensureHighlightElementsCreated();
        console.log('[DEBUG] ä¿å­˜çš„ä¿®æ”¹åº”ç”¨å®Œæˆ');
      } catch (error) {
        console.error('[ERROR] åº”ç”¨ä¿å­˜çš„ä¿®æ”¹å¤±è´¥:', error);
      }
    }, 500);
  });

  console.log('[DEBUG] ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆ');
}

// ç¡®ä¿åˆ›å»ºå’Œæ˜¾ç¤ºé«˜äº®å…ƒç´ 
function ensureHighlightElementsCreated() {
  console.log('[DEBUG] ç¡®ä¿é«˜äº®å…ƒç´ å·²åˆ›å»º');
  const v = window.editorVars;
  
  // æ£€æŸ¥æ£€æŸ¥é«˜äº®å…ƒç´ 
  if (!document.querySelector('.element-highlight[data-highlight-type="inspect"]')) {
    console.log('[DEBUG] åˆ›å»ºæ£€æŸ¥é«˜äº®å…ƒç´ ');
    const highlight = document.createElement('div');
    highlight.className = 'element-highlight';
    highlight.setAttribute('data-highlight-type', 'inspect');
    highlight.style.position = 'absolute';
    highlight.style.zIndex = '9999';
    highlight.style.pointerEvents = 'none';
    highlight.style.border = '2px solid #ea4335';
    highlight.style.backgroundColor = 'rgba(234, 67, 53, 0.1)';
    highlight.style.boxSizing = 'border-box';
    highlight.style.display = 'none';
    document.body.appendChild(highlight);
    v.highlightElement = highlight;
    console.log('[DEBUG] æ£€æŸ¥é«˜äº®å…ƒç´ å·²åˆ›å»º');
  } else {
    console.log('[DEBUG] æ£€æŸ¥é«˜äº®å…ƒç´ å·²å­˜åœ¨');
    v.highlightElement = document.querySelector('.element-highlight[data-highlight-type="inspect"]');
  }
  
  // æ£€æŸ¥æ‚¬åœé«˜äº®å…ƒç´ 
  if (!document.querySelector('.element-highlight[data-highlight-type="hover"]')) {
    console.log('[DEBUG] åˆ›å»ºæ‚¬åœé«˜äº®å…ƒç´ ');
    const hover = document.createElement('div');
    hover.className = 'element-highlight';
    hover.setAttribute('data-highlight-type', 'hover');
    hover.style.position = 'absolute';
    hover.style.zIndex = '9998';
    hover.style.pointerEvents = 'none';
    hover.style.backgroundColor = 'rgba(66, 133, 244, 0.2)';
    hover.style.border = '2px solid #4285f4';
    hover.style.boxSizing = 'border-box';
    hover.style.display = 'none';
    document.body.appendChild(hover);
    v.hoveredHighlight = hover;
    console.log('[DEBUG] æ‚¬åœé«˜äº®å…ƒç´ å·²åˆ›å»º');
  } else {
    console.log('[DEBUG] æ‚¬åœé«˜äº®å…ƒç´ å·²å­˜åœ¨');
    v.hoveredHighlight = document.querySelector('.element-highlight[data-highlight-type="hover"]');
  }
  
  console.log('[DEBUG] é«˜äº®å…ƒç´ åˆ›å»ºå®Œæˆ', {
    highlightElement: !!v.highlightElement,
    hoveredHighlight: !!v.hoveredHighlight
  });
}

// ç»‘å®šæŒ‰é’®äº‹ä»¶å¤„ç†
function bindButtonEvents() {
  const v = window.editorVars;
  const buttons = v.buttons;
  
  if (!buttons) {
    console.error('[ERROR] æŒ‰é’®æœªå®šä¹‰ï¼Œæ— æ³•ç»‘å®šäº‹ä»¶');
    return;
  }
  
  console.log('[DEBUG] å¼€å§‹ç»‘å®šæŒ‰é’®äº‹ä»¶');

  // åˆ‡æ¢å…ƒç´ æ£€æŸ¥æ¨¡å¼
  buttons.inspectBtn.addEventListener('click', function(e) {
    console.log('[DEBUG] å…ƒç´ æ£€æŸ¥æŒ‰é’®è¢«ç‚¹å‡»', e.type);
    console.log('[DEBUG] ç‚¹å‡»å‰çŠ¶æ€:', { 
      isInspecting: v.isInspecting,
      isTextEditMode: v.isTextEditMode,
      isImageEditMode: v.isImageEditMode,
      isEditMode: v.isEditMode
    });
    
    // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
    document.removeEventListener('mousemove', handleInspectorMouseMove);
    document.removeEventListener('mousemove', handleMouseMove);
    console.log('[DEBUG] æ—§äº‹ä»¶å¤„ç†ç¨‹åºå·²æ¸…é™¤');
    
    // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
    if (v.isTextEditMode) {
      console.log('[DEBUG] å…³é—­æ–‡æœ¬ç¼–è¾‘æ¨¡å¼');
      v.isTextEditMode = false;
      removeTextEditability();
      buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
      buttons.textEditBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isImageEditMode) {
      console.log('[DEBUG] å…³é—­å›¾ç‰‡ç¼–è¾‘æ¨¡å¼');
      v.isImageEditMode = false;
      completelyRemoveImageEditability();
      buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
      buttons.imageEditBtn.style.backgroundColor = '#4285f4';
      buttons.imageEditBtn.style.color = '#fff';
    }
    
    if (v.isEditMode) {
      console.log('[DEBUG] å…³é—­åŒºåŸŸç¼–è¾‘æ¨¡å¼');
      v.isEditMode = false;
      removeEditModeFromDivs();
      buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
      buttons.editBtn.style.backgroundColor = '#4285f4';
    }
    
    // åˆ‡æ¢æ£€æŸ¥æ¨¡å¼çŠ¶æ€
    v.isInspecting = !v.isInspecting;
    console.log('[DEBUG] æ£€æŸ¥æ¨¡å¼åˆ‡æ¢ä¸º:', v.isInspecting);
    
    if (v.isInspecting) {
      console.log('[DEBUG] å¯ç”¨å…ƒç´ æ£€æŸ¥');
      this.innerText = 'ç¦ç”¨å…ƒç´ æ£€æŸ¥';
      this.style.backgroundColor = '#ea4335';
      
      try {
        // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
        console.log('[DEBUG] å°è¯•ç»‘å®šæ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶');
        document.addEventListener('mousemove', handleInspectorMouseMove);
        console.log('[DEBUG] æ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç»‘å®šæˆåŠŸ');
      } catch (error) {
        console.error('[ERROR] ç»‘å®šæ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤±è´¥:', error);
      }
    } else {
      console.log('[DEBUG] ç¦ç”¨å…ƒç´ æ£€æŸ¥');
      this.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
      this.style.backgroundColor = '#4285f4';
      
      try {
        // éšè—æ£€æŸ¥å™¨å’Œé«˜äº®
        console.log('[DEBUG] å°è¯•éšè—æ£€æŸ¥å™¨å’Œé«˜äº®');
        hideInspector();
        hideHighlight();
        console.log('[DEBUG] æ£€æŸ¥å™¨å’Œé«˜äº®éšè—æˆåŠŸ');
        
        // è§£ç»‘é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
        document.removeEventListener('mousemove', handleInspectorMouseMove);
        console.log('[DEBUG] æ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§£ç»‘æˆåŠŸ');
      } catch (error) {
        console.error('[ERROR] éšè—æ£€æŸ¥å™¨æˆ–è§£ç»‘äº‹ä»¶å¤±è´¥:', error);
      }
    }
    console.log('[DEBUG] å…ƒç´ æ£€æŸ¥æ¨¡å¼åˆ‡æ¢å®Œæˆ');
  });
  
  // åˆ‡æ¢åŒºåŸŸç¼–è¾‘æ¨¡å¼
  buttons.editBtn.addEventListener('click', function(e) {
    console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æŒ‰é’®è¢«ç‚¹å‡»', e.type);
    console.log('[DEBUG] ç‚¹å‡»å‰çŠ¶æ€:', { 
      isEditMode: v.isEditMode,
      isInspecting: v.isInspecting, 
      isTextEditMode: v.isTextEditMode,
      isImageEditMode: v.isImageEditMode
    });
    
    // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
    document.removeEventListener('mousemove', handleInspectorMouseMove);
    document.removeEventListener('mousemove', handleMouseMove);
    console.log('[DEBUG] æ—§äº‹ä»¶å¤„ç†ç¨‹åºå·²æ¸…é™¤');
    
    // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
    if (v.isInspecting) {
      console.log('[DEBUG] å…³é—­å…ƒç´ æ£€æŸ¥æ¨¡å¼');
      v.isInspecting = false;
      hideInspector();
      hideHighlight();
      buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
      buttons.inspectBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isTextEditMode) {
      console.log('[DEBUG] å…³é—­æ–‡æœ¬ç¼–è¾‘æ¨¡å¼');
      v.isTextEditMode = false;
      removeTextEditability();
      buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
      buttons.textEditBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isImageEditMode) {
      console.log('[DEBUG] å…³é—­å›¾ç‰‡ç¼–è¾‘æ¨¡å¼');
      v.isImageEditMode = false;
      completelyRemoveImageEditability();
      buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
      buttons.imageEditBtn.style.backgroundColor = '#4285f4';
      buttons.imageEditBtn.style.color = '#fff';
    }
    
    // åˆ‡æ¢åŒºåŸŸç¼–è¾‘çŠ¶æ€
    v.isEditMode = !v.isEditMode;
    console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åˆ‡æ¢ä¸º:', v.isEditMode);
    
    if (v.isEditMode) {
      console.log('[DEBUG] å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
      this.innerText = 'ç¦ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
      this.style.backgroundColor = '#ea4335';
      
      try {
        // åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼
        console.log('[DEBUG] å°è¯•åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
        applyEditModeToDivs();
        console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åº”ç”¨æˆåŠŸ');
        
        // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
        console.log('[DEBUG] å°è¯•ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶');
        document.addEventListener('mousemove', handleMouseMove);
        console.log('[DEBUG] é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç»‘å®šæˆåŠŸ');
      } catch (error) {
        console.error('[ERROR] åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
      }
    } else {
      console.log('[DEBUG] ç¦ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
      this.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
      this.style.backgroundColor = '#4285f4';
      
      try {
        // ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼
        console.log('[DEBUG] å°è¯•ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼');
        removeEditModeFromDivs();
        console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼ç§»é™¤æˆåŠŸ');
        
        // è§£ç»‘é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
        document.removeEventListener('mousemove', handleMouseMove);
        console.log('[DEBUG] é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§£ç»‘æˆåŠŸ');
      } catch (error) {
        console.error('[ERROR] ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
      }
    }
    console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åˆ‡æ¢å®Œæˆ');
  });
  
  // åˆ‡æ¢æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
  buttons.textEditBtn.addEventListener('click', function() {
    // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
    document.removeEventListener('mousemove', handleInspectorMouseMove);
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mousemove', handleImageEditMouseMove);
    
    // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
    clearAllEditModes();
    
    // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
    if (v.isImageEditMode) {
      v.isImageEditMode = false;
      completelyRemoveImageEditability();
      buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
      buttons.imageEditBtn.style.backgroundColor = '#4285f4';
      buttons.imageEditBtn.style.color = '#fff';
    }
    
    if (v.isInspecting) {
      v.isInspecting = false;
      hideInspector();
      hideHighlight();
      buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
      buttons.inspectBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isEditMode) {
      v.isEditMode = false;
      removeEditModeFromDivs();
      buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
      buttons.editBtn.style.backgroundColor = '#4285f4';
    }
    
    v.isTextEditMode = !v.isTextEditMode;
    
    if (v.isTextEditMode) {
      // å¯ç”¨æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
      this.innerText = 'ç¦ç”¨æ–‡æœ¬ç¼–è¾‘';
      this.style.backgroundColor = '#34a853';
      
      // ä½¿æ‰€æœ‰æ–‡æœ¬å…ƒç´ å¯ç¼–è¾‘
      makeElementEditable(document.body);
    } else {
      // ç¦ç”¨æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
      this.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
      this.style.backgroundColor = '#4285f4';
      
      // ç§»é™¤å¯ç¼–è¾‘å±æ€§
      removeTextEditability();
    }
  });
  
  // åˆ‡æ¢å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
  buttons.imageEditBtn.addEventListener('click', function() {
    // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
    document.removeEventListener('mousemove', handleInspectorMouseMove);
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mousemove', handleImageEditMouseMove);
    
    // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
    clearAllEditModes();
    
    // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
    if (v.isTextEditMode) {
      v.isTextEditMode = false;
      removeTextEditability();
      buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
      buttons.textEditBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isInspecting) {
      v.isInspecting = false;
      hideInspector();
      hideHighlight();
      buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
      buttons.inspectBtn.style.backgroundColor = '#4285f4';
    }
    
    if (v.isEditMode) {
      v.isEditMode = false;
      removeEditModeFromDivs();
      buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
      buttons.editBtn.style.backgroundColor = '#4285f4';
    }
    
    v.isImageEditMode = !v.isImageEditMode;
    
    if (v.isImageEditMode) {
      // å¯ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
      this.innerText = 'ç¦ç”¨å›¾ç‰‡ç¼–è¾‘';
      this.style.backgroundColor = '#fbbc05';
      this.style.color = '#000';
      
      console.log('[DEBUG] æ­£åœ¨å¯ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼...');
      
      // ä½¿æ‰€æœ‰å›¾ç‰‡å…ƒç´ å¯ç¼–è¾‘
      makeImagesEditable();
      
      // é˜»æ­¢é“¾æ¥ç‚¹å‡»äº‹ä»¶
      document.querySelectorAll('a[data-image-editable-container="true"]').forEach(link => {
        link.addEventListener('click', preventLinkClick);
      });
      
      // æ˜¾ç¤ºå®¹å™¨ç¼–è¾‘å›¾æ ‡
      document.querySelectorAll('[data-container-editable="true"] .container-edit-icon').forEach(icon => {
        if (icon) {
          icon.style.display = 'block';
        }
      });
      
      // æ·»åŠ é¼ æ ‡ç§»åŠ¨äº‹ä»¶æ¥é«˜äº®div
      document.addEventListener('mousemove', handleImageEditMouseMove);
      
      console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘æ¨¡å¼å·²å¯ç”¨ï¼Œå¯ä»¥ç‚¹å‡»divæˆ–å›¾ç‰‡');
    } else {
      // ç¦ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
      this.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
      this.style.backgroundColor = '#4285f4';
      this.style.color = '#fff';
      
      // ä½¿ç”¨å¢å¼ºçš„æ¸…ç†å‡½æ•°
      completelyRemoveImageEditability();
      
      // æ¢å¤é“¾æ¥ç‚¹å‡»è¡Œä¸º
      document.querySelectorAll('a[data-image-editable-container="true"]').forEach(link => {
        link.removeEventListener('click', preventLinkClick);
        link.removeAttribute('data-image-editable-container');
      });
      
      // ç§»é™¤é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç›‘å¬
      document.removeEventListener('mousemove', handleImageEditMouseMove);
      
      // éšè—é«˜äº®
      hideHoverHighlight();
      
      // ç§»é™¤æ‰€æœ‰div-hover-highlightç±»
      document.querySelectorAll('.div-hover-highlight').forEach(div => {
        div.classList.remove('div-hover-highlight');
        div.style.cursor = '';
      });
      
      // ç§»é™¤æ‰€æœ‰div-image-containerç±»
      document.querySelectorAll('.div-image-container').forEach(div => {
        div.classList.remove('div-image-container');
        div.removeAttribute('data-images-count');
      });
    }
  });
  
  console.log('[DEBUG] æŒ‰é’®äº‹ä»¶ç»‘å®šå®Œæˆ');
}

// æ˜¾ç¤ºæ£€æŸ¥å™¨æç¤º
function showInspector(x, y, element) {
  const v = window.editorVars;
  console.log('[DEBUG] æ˜¾ç¤ºæ£€æŸ¥å™¨:', { x, y, element: element ? element.tagName : 'null' });
  
  if (!element) {
    console.log('[DEBUG] æ— å…ƒç´ å¯æ£€æŸ¥');
    return;
  }
  
  // è·å–DOMå…ƒç´ 
  const inspector = document.getElementById('elementInspector');
  if (!inspector) {
    console.error('[ERROR] æ‰¾ä¸åˆ°æ£€æŸ¥å™¨å…ƒç´ ');
    return;
  }
  
  // æŸ¥æ‰¾å…ƒç´ æ‰€åœ¨çš„æœ€è¿‘çš„div
  let containingDiv = element;
  while (containingDiv && containingDiv.tagName.toLowerCase() !== 'div' && containingDiv !== document.body) {
    containingDiv = containingDiv.parentElement;
  }
  
  if (!containingDiv || containingDiv === document.body) {
    containingDiv = element; // å¦‚æœæ‰¾ä¸åˆ°åŒ…å«çš„divï¼Œåˆ™æ˜¾ç¤ºå…ƒç´ æœ¬èº«
  }
  
  console.log('[DEBUG] æ‰¾åˆ°åŒ…å«å…ƒç´ :', containingDiv ? containingDiv.tagName : 'null');
  
  // è·å–å…ƒç´ åç§°
  let info = '';
  if (containingDiv.tagName) {
    info = containingDiv.tagName.toLowerCase();
    
    if (containingDiv.id) {
      info += `#${containingDiv.id}`;
    }
    
    if (containingDiv.className && typeof containingDiv.className === 'string' && containingDiv.className.trim()) {
      const classNames = containingDiv.className.split(' ').filter(cls => cls.trim());
      if (classNames.length > 0) {
        info += `.${classNames.join('.')}`;
      }
    }
  }
  
  console.log('[DEBUG] å…ƒç´ ä¿¡æ¯:', info);
  
  inspector.innerHTML = `<div><strong>${info}</strong></div>`;
  inspector.style.display = 'block';
  
  // ç¡®ä¿æç¤ºæ¡†åœ¨è§†çª—å†…
  const inspectorRect = inspector.getBoundingClientRect();
  let left = x + 15;
  let top = y;
  
  if (left + inspectorRect.width > window.innerWidth) {
    left = x - inspectorRect.width - 5;
  }
  
  if (top + inspectorRect.height > window.innerHeight) {
    top = window.innerHeight - inspectorRect.height - 5;
  }
  
  inspector.style.left = `${left}px`;
  inspector.style.top = `${top}px`;
  
  try {
    // é«˜äº®æ˜¾ç¤ºdivå…ƒç´ 
    console.log('[DEBUG] å°è¯•é«˜äº®æ˜¾ç¤ºå…ƒç´ ');
    highlightTargetElement(containingDiv);
    console.log('[DEBUG] å…ƒç´ é«˜äº®æˆåŠŸ');
  } catch (error) {
    console.error('[ERROR] å…ƒç´ é«˜äº®å¤±è´¥:', error);
  }
}

// é«˜äº®æ˜¾ç¤ºå…ƒç´ 
function highlightTargetElement(element) {
  const v = window.editorVars;
  console.log('[DEBUG] é«˜äº®æ˜¾ç¤ºå…ƒç´ :', element ? element.tagName : 'null');
  
  if (!element) {
    console.log('[DEBUG] æ— å…ƒç´ å¯é«˜äº®');
    return;
  }
  
  if (!v.highlightElement) {
    console.log('[DEBUG] é«˜äº®å…ƒç´ ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º');
    ensureHighlightElementsCreated();
  }
  
  const highlight = v.highlightElement;
  console.log('[DEBUG] é«˜äº®å…ƒç´ çŠ¶æ€:', !!highlight);
  
  if (!highlight) {
    console.error('[ERROR] é«˜äº®å…ƒç´ åˆ›å»ºå¤±è´¥');
    return;
  }
  
  const rect = element.getBoundingClientRect();
  console.log('[DEBUG] å…ƒç´ ä½ç½®:', { 
    top: rect.top, 
    left: rect.left, 
    width: rect.width, 
    height: rect.height 
  });
  
  highlight.style.top = (rect.top + window.scrollY) + 'px';
  highlight.style.left = (rect.left + window.scrollX) + 'px';
  highlight.style.width = rect.width + 'px';
  highlight.style.height = rect.height + 'px';
  highlight.style.display = 'block';
}

// å¤„ç†é¼ æ ‡ç§»åŠ¨äº‹ä»¶ - å…ƒç´ æ£€æŸ¥æ¨¡å¼
function handleInspectorMouseMove(e) {
  console.log('[DEBUG] å¤„ç†æ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨:', { x: e.clientX, y: e.clientY });
  const x = e.clientX;
  const y = e.clientY;
  const element = document.elementFromPoint(x, y);
  console.log('[DEBUG] é¼ æ ‡ä¸‹å…ƒç´ :', element ? element.tagName : 'null');
  
  // å¿½ç•¥ç¼–è¾‘å™¨è‡ªèº«çš„å…ƒç´ 
  if (element && (
      element.id === 'elementInspector' || 
      element.classList.contains('element-highlight') ||
      element.classList.contains('editor-button'))) {
    console.log('[DEBUG] å¿½ç•¥ç¼–è¾‘å™¨è‡ªèº«å…ƒç´ ');
    return;
  }
  
  try {
    console.log('[DEBUG] å°è¯•æ˜¾ç¤ºæ£€æŸ¥å™¨');
    showInspector(x, y, element);
    console.log('[DEBUG] æ£€æŸ¥å™¨æ˜¾ç¤ºæˆåŠŸ');
  } catch (error) {
    console.error('[ERROR] æ˜¾ç¤ºæ£€æŸ¥å™¨å¤±è´¥:', error);
  }
}

// éšè—é«˜äº®
function hideHighlight() {
  console.log('[DEBUG] éšè—é«˜äº®å…ƒç´ ');
  if (window.editorVars.highlightElement) {
    window.editorVars.highlightElement.style.display = 'none';
    console.log('[DEBUG] é«˜äº®å…ƒç´ å·²éšè—');
  } else {
    console.log('[DEBUG] æ— é«˜äº®å…ƒç´ å¯éšè—');
  }
}

// éšè—æ£€æŸ¥å™¨æç¤º
function hideInspector() {
  console.log('[DEBUG] éšè—æ£€æŸ¥å™¨');
  const inspector = document.getElementById('elementInspector');
  if (inspector) {
    inspector.style.display = 'none';
    console.log('[DEBUG] æ£€æŸ¥å™¨å·²éšè—');
  } else {
    console.log('[DEBUG] æ— æ£€æŸ¥å™¨å¯éšè—');
  }
  hideHighlight();
}

// é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†
function handleMouseMove(e) {
  console.log('[DEBUG] å¤„ç†é¼ æ ‡ç§»åŠ¨äº‹ä»¶');
  
  if (!window.editorVars.isEditMode) {
    console.log('[DEBUG] ç¼–è¾‘æ¨¡å¼æœªå¯ç”¨ï¼Œä¸å¤„ç†é¼ æ ‡ç§»åŠ¨');
    return;
  }
  
  const element = document.elementFromPoint(e.clientX, e.clientY);
  console.log('[DEBUG] é¼ æ ‡ä¸‹å…ƒç´ :', element ? element.tagName : 'null');
  
  // å¿½ç•¥æˆ‘ä»¬çš„UIå…ƒç´ 
  if (element && (
      element.id === 'elementInspector' || 
      element.id === 'divEditorButtons' || 
      element.classList.contains('element-highlight') ||
      element.classList.contains('editor-button') ||
      element === document.getElementById('editDuplicateBtn') ||
      element === document.getElementById('editRemoveBtn'))) {
    console.log('[DEBUG] å¿½ç•¥UIå…ƒç´ ');
    hideHoverHighlight();
    return;
  }
  
  // æŸ¥æ‰¾æœ€è¿‘çš„divå…ƒç´ 
  let targetDiv = element;
  while (targetDiv && targetDiv.tagName.toLowerCase() !== 'div' && targetDiv !== document.body) {
    targetDiv = targetDiv.parentElement;
  }
  
  console.log('[DEBUG] ç›®æ ‡DIV:', targetDiv ? targetDiv.tagName : 'null');
  
  if (!targetDiv || targetDiv === document.body || targetDiv === window.editorVars.selectedElement) {
    console.log('[DEBUG] æ— æ•ˆç›®æ ‡æˆ–å·²é€‰ä¸­ï¼Œéšè—é«˜äº®');
    hideHoverHighlight();
    return;
  }
  
  // æ›´æ–°å½“å‰æ‚¬åœå…ƒç´ 
  window.editorVars.hoverElement = targetDiv;
  console.log('[DEBUG] æ›´æ–°æ‚¬åœå…ƒç´ :', window.editorVars.hoverElement.tagName);
  
  try {
    // æ˜¾ç¤ºé«˜äº®
    console.log('[DEBUG] å°è¯•é«˜äº®æ‚¬åœå…ƒç´ ');
    highlightHoverElement(window.editorVars.hoverElement);
    console.log('[DEBUG] æ‚¬åœå…ƒç´ é«˜äº®æˆåŠŸ');
  } catch (error) {
    console.error('[ERROR] æ‚¬åœå…ƒç´ é«˜äº®å¤±è´¥:', error);
  }
}

// éšè—æ‚¬åœé«˜äº®
function hideHoverHighlight() {
  console.log('[DEBUG] éšè—æ‚¬åœé«˜äº®');
  if (window.editorVars.hoveredHighlight) {
    window.editorVars.hoveredHighlight.style.display = 'none';
    console.log('[DEBUG] æ‚¬åœé«˜äº®å·²éšè—');
  } else {
    console.log('[DEBUG] æ— æ‚¬åœé«˜äº®å¯éšè—');
  }
}

// é«˜äº®æ˜¾ç¤ºæ‚¬åœå…ƒç´ 
function highlightHoverElement(element) {
  const v = window.editorVars;
  console.log('[DEBUG] é«˜äº®æ˜¾ç¤ºæ‚¬åœå…ƒç´ :', element ? element.tagName : 'null');
  
  if (!element) {
    console.log('[DEBUG] æ— å…ƒç´ å¯é«˜äº®');
    return;
  }
  
  if (!v.hoveredHighlight) {
    console.log('[DEBUG] æ‚¬åœé«˜äº®å…ƒç´ ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»º');
    ensureHighlightElementsCreated();
  }
  
  const hover = v.hoveredHighlight;
  console.log('[DEBUG] æ‚¬åœé«˜äº®å…ƒç´ çŠ¶æ€:', !!hover);
  
  if (!hover) {
    console.error('[ERROR] æ‚¬åœé«˜äº®å…ƒç´ åˆ›å»ºå¤±è´¥');
    return;
  }
  
  const rect = element.getBoundingClientRect();
  console.log('[DEBUG] å…ƒç´ ä½ç½®:', { 
    top: rect.top, 
    left: rect.left, 
    width: rect.width, 
    height: rect.height 
  });
  
  hover.style.top = (rect.top + window.scrollY) + 'px';
  hover.style.left = (rect.left + window.scrollX) + 'px';
  hover.style.width = rect.width + 'px';
  hover.style.height = rect.height + 'px';
  hover.style.display = 'block';
}

// åº”ç”¨ç¼–è¾‘æ¨¡å¼åˆ°æ‰€æœ‰div
function applyEditModeToDivs() {
  console.log('[DEBUG] åº”ç”¨ç¼–è¾‘æ¨¡å¼åˆ°æ‰€æœ‰DIV');
  const v = window.editorVars;
  const divs = document.querySelectorAll('div');
  console.log('[DEBUG] æ‰¾åˆ°DIVå…ƒç´ æ•°é‡:', divs.length);
  
  let appliedCount = 0;
  divs.forEach(div => {
    // æ’é™¤æˆ‘ä»¬è‡ªå·±çš„å…ƒç´ 
    if (div.id === 'elementInspector' || 
        div.id === 'divEditorButtons' || 
        div.classList.contains('element-highlight') ||
        div.classList.contains('editor-button')) {
      return;
    }
    
    try {
      // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
      div.removeEventListener('click', handleElementClick);
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      div.addEventListener('click', handleElementClick);
      
      // å¦‚æœå›¾ç‰‡ç¼–è¾‘æ¨¡å¼å’ŒåŒºåŸŸç¼–è¾‘æ¨¡å¼åŒæ—¶å¼€å¯ï¼Œæ·»åŠ å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½
      if (v.isImageEditMode) {
        div.addEventListener('click', function(e) {
          // åªæœ‰åœ¨é€‰ä¸­çŠ¶æ€ä¸‹æ‰å…è®¸ç¼–è¾‘å›¾ç‰‡
          if (v.selectedElement === this) {
            handleImageEditClick.call(this, e);
          }
        });
      }
      
      // æ·»åŠ æ ·å¼
      div.style.cursor = 'pointer';
      appliedCount++;
    } catch (error) {
      console.error('[ERROR] ä¸ºDIVåº”ç”¨ç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
    }
  });
}

// å®Œå…¨ç§»é™¤å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½
function completelyRemoveImageEditability() {
  const v = window.editorVars;
  console.log('[DEBUG] å®Œå…¨ç§»é™¤å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½');
  
  try {
    // ç§»é™¤æ‰€æœ‰å›¾ç‰‡çš„å¯ç¼–è¾‘çŠ¶æ€
    document.querySelectorAll('img.image-editable').forEach(img => {
      img.classList.remove('image-editable');
      img.style.cursor = '';
      img.style.border = '';
      img.style.padding = '';
      img.style.margin = '';
      img.style.outline = '';
      img.removeEventListener('click', handleImageEditClick);
    });
    
    // ç§»é™¤æ‰€æœ‰èƒŒæ™¯å›¾ç‰‡çš„å¯ç¼–è¾‘çŠ¶æ€
    document.querySelectorAll('.bg-image-editable, [data-bg-editable]').forEach(el => {
      el.classList.remove('bg-image-editable');
      el.removeAttribute('data-bg-editable');
      el.style.cursor = '';
      el.style.outline = '';
      el.removeEventListener('click', handleImageEditClick);
    });
    
    // ç§»é™¤è½®æ’­å›¾å®¹å™¨çš„å¯ç¼–è¾‘çŠ¶æ€
    document.querySelectorAll('.carousel-container-editable, [data-carousel-editable]').forEach(carousel => {
      carousel.classList.remove('carousel-container-editable');
      carousel.removeAttribute('data-carousel-editable');
      carousel.style.outline = '';
      
      // ç§»é™¤æç¤ºæ ‡è®°
      const hint = carousel.querySelector('[data-carousel-hint]');
      if (hint && hint.parentElement) {
        hint.parentElement.removeChild(hint);
      }
    });
    
    // ç§»é™¤å®¹å™¨ç¼–è¾‘æ ‡è®°å’Œäº‹ä»¶
    document.querySelectorAll('[data-container-editable="true"]').forEach(container => {
      container.removeAttribute('data-container-editable');
      
      // ç§»é™¤ç¼–è¾‘å›¾æ ‡
      const icon = container.querySelector('.container-edit-icon');
      if (icon) {
        icon.style.display = 'none';
      }
    });
    
    // ç§»é™¤æ‰€æœ‰å®¹å™¨æç¤º
    document.querySelectorAll('[data-container-hint]').forEach(hint => {
      if (hint.parentElement) {
        hint.parentElement.removeChild(hint);
      }
    });
    
    // ç§»é™¤æ‰€æœ‰div-image-containerç±»å’Œé«˜äº®
    document.querySelectorAll('.div-image-container, .div-hover-highlight').forEach(div => {
      div.classList.remove('div-image-container');
      div.classList.remove('div-hover-highlight');
      div.style.cursor = '';
      div.style.outline = '';
      div.style.border = '';
      div.removeAttribute('data-images-count');
    });
    
    // æ¢å¤é“¾æ¥ç‚¹å‡»è¡Œä¸º
    document.querySelectorAll('a[data-image-editable-container="true"]').forEach(link => {
      link.removeEventListener('click', preventLinkClick);
      link.removeAttribute('data-image-editable-container');
    });
    
    // ä¸ºæ‰€æœ‰divç§»é™¤ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('div').forEach(div => {
      div.removeEventListener('click', handleImageEditClick);
    });
    
    // å…³é—­å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
    closeImageUploadModal();
    
    // é‡ç½®å˜é‡
    v.currentEditingImage = null;
    v.currentEditingElement = null;
    v.currentEditingType = 'single';
    v.containerImages = [];
    v.selectedSingleFile = null;
    v.selectedMultipleFiles = null;
    v.currentImageIndex = 0;
    
    // éšè—é«˜äº®
    hideHighlight();
    hideHoverHighlight();
    
    console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½å·²å®Œå…¨ç§»é™¤');
  } catch (error) {
    console.error('[ERROR] ç§»é™¤å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½æ—¶å‡ºé”™:', error);
  }
}

// ç§»é™¤å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½
function removeImageEditability() {
  // ç§»é™¤æ‰€æœ‰å›¾ç‰‡çš„ç¼–è¾‘çŠ¶æ€
  document.querySelectorAll('img.image-editable').forEach(img => {
    img.classList.remove('image-editable');
    img.style.cursor = '';
    img.style.border = '';
    img.style.padding = '';
    img.style.margin = '';
    img.style.outline = '';
    img.removeEventListener('click', handleImageEditClick);
  });
  
  // ç§»é™¤æ‰€æœ‰èƒŒæ™¯å›¾ç‰‡çš„ç¼–è¾‘çŠ¶æ€
  document.querySelectorAll('.bg-image-editable, [data-bg-editable]').forEach(el => {
    el.classList.remove('bg-image-editable');
    el.removeAttribute('data-bg-editable');
    el.style.cursor = '';
    el.style.outline = '';
    el.removeEventListener('click', handleImageEditClick);
  });
  
  // ç§»é™¤è½®æ’­å›¾å®¹å™¨çš„ç¼–è¾‘çŠ¶æ€
  document.querySelectorAll('.carousel-container-editable, [data-carousel-editable]').forEach(carousel => {
    carousel.classList.remove('carousel-container-editable');
    carousel.removeAttribute('data-carousel-editable');
    
    // ç§»é™¤æç¤ºæ ‡è®°
    const hint = carousel.querySelector('[data-carousel-hint]');
    if (hint) {
      carousel.removeChild(hint);
    }
  });
  
  // ç§»é™¤åŒºåŸŸå®¹å™¨ä¸­çš„å›¾ç‰‡ç¼–è¾‘æç¤º
  document.querySelectorAll('[data-container-hint]').forEach(hint => {
    if (hint.parentElement) {
      hint.parentElement.removeChild(hint);
    }
  });
  
  // å…³é—­å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
  const imageUploadModal = document.getElementById('imageUploadModal');
  if (imageUploadModal) {
    imageUploadModal.style.display = 'none';
  }
  
  console.log('[DEBUG] å·²ç§»é™¤æ‰€æœ‰å›¾ç‰‡ç¼–è¾‘åŠŸèƒ½');
}

// å¤„ç†å›¾ç‰‡ç¼–è¾‘ç‚¹å‡»äº‹ä»¶
function handleImageEditClick(e) {
  const v = window.editorVars;
  console.log('[DEBUG] å¤„ç†å›¾ç‰‡ç¼–è¾‘ç‚¹å‡»äº‹ä»¶', e.currentTarget.tagName);
  
  if (!v.isImageEditMode) {
    console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘æ¨¡å¼æœªå¯ç”¨ï¼Œä¸å¤„ç†ç‚¹å‡»');
    return;
  }
  
  // é˜»æ­¢äº‹ä»¶å†’æ³¡å’Œé»˜è®¤è¡Œä¸º
  e.preventDefault();
  e.stopPropagation();
  
  // è·å–ç‚¹å‡»çš„å…ƒç´ 
  const element = e.currentTarget;
  console.log('[DEBUG] ç‚¹å‡»çš„å…ƒç´ ç±»å‹:', element.tagName);
  
  // è®°å½•å½“å‰ç¼–è¾‘çš„å…ƒç´ 
  v.currentEditingElement = element;
  
  // ç¡®å®šç¼–è¾‘ç±»å‹
  if (element.tagName === 'IMG') {
    v.currentEditingType = 'single';
    v.currentEditingImage = element; // ä¿å­˜å½“å‰ç¼–è¾‘çš„å›¾ç‰‡å…ƒç´ 
    console.log('[DEBUG] è¯†åˆ«ä¸ºå•å›¾ç‰‡ç¼–è¾‘');
  } else if (element.classList.contains('bg-image-editable')) {
    v.currentEditingType = 'background';
    console.log('[DEBUG] è¯†åˆ«ä¸ºèƒŒæ™¯å›¾ç‰‡ç¼–è¾‘');
  } else if (element.classList.contains('carousel-container-editable')) {
    v.currentEditingType = 'carousel';
    console.log('[DEBUG] è¯†åˆ«ä¸ºè½®æ’­å›¾ç¼–è¾‘');
    
    // æ‰¾åˆ°å®¹å™¨å†…çš„æ‰€æœ‰å›¾ç‰‡
    v.containerImages = Array.from(element.querySelectorAll('img'));
  } else if (element.tagName.toLowerCase() === 'div') {
    // divå®¹å™¨ä¸­çš„å›¾ç‰‡ - ä¸å†éœ€è¦v.isEditModeæ£€æŸ¥ï¼Œå› ä¸ºç°åœ¨ç›´æ¥åœ¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼ä¸‹å¯ä»¥ç‚¹å‡»div
    v.currentEditingType = 'container';
    console.log('[DEBUG] è¯†åˆ«ä¸ºå®¹å™¨å›¾ç‰‡ç¼–è¾‘');
    
    // æ¸…ç©ºä¹‹å‰çš„å®¹å™¨å›¾ç‰‡åˆ—è¡¨
    v.containerImages = [];
    
    // ç›´æ¥æ‰¾åˆ°å½“å‰divå†…çš„æ‰€æœ‰å›¾ç‰‡
    const images = element.querySelectorAll('img');
    console.log('[DEBUG] æ‰¾åˆ°åŸå§‹å›¾ç‰‡æ•°é‡:', images.length);
    
    // è½¬ä¸ºæ•°ç»„å¹¶è¿‡æ»¤æ‰ç¼–è¾‘å™¨è‡ªèº«çš„å›¾ç‰‡
    v.containerImages = Array.from(images).filter(img => {
      // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å±äºç¼–è¾‘å™¨å…ƒç´ 
      const isEditorElement = img.closest('#elementInspector') || 
                            img.closest('#divEditorButtons') || 
                            img.closest('#imageUploadModal') ||
                            img.closest('.editor-button');
      return !isEditorElement;
    });
    
    console.log('[DEBUG] è¿‡æ»¤åçš„å›¾ç‰‡æ•°é‡:', v.containerImages.length);
    
    if (v.containerImages.length === 0) {
      alert('æ‰€é€‰åŒºåŸŸå†…æ²¡æœ‰å¯æ›¿æ¢çš„å›¾ç‰‡');
      return;
    }
    
    console.log(`[DEBUG] å‘ç°åŒºåŸŸå†…æœ‰ ${v.containerImages.length} å¼ å›¾ç‰‡å¯æ›¿æ¢`);
  }
  
  // æ˜¾ç¤ºä¸Šä¼ æ¨¡æ€æ¡†
  console.log('[DEBUG] å‡†å¤‡æ˜¾ç¤ºä¸Šä¼ æ¨¡æ€æ¡†');
  createImageUploadModal();
}

// é˜»æ­¢é“¾æ¥ç‚¹å‡»äº‹ä»¶å‡½æ•°
function preventLinkClick(e) {
  const v = window.editorVars;
  if (v.isImageEditMode) {
    e.preventDefault();
    e.stopPropagation();
    return false;
  }
}

// åˆ›å»ºå›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
function createImageUploadModal() {
  const v = window.editorVars;
  
  const modal = document.getElementById('imageUploadModal');
  const description = document.getElementById('imageUploadDescription');
  const uploadTypeToggle = document.getElementById('uploadTypeToggle');
  const singleFileInput = document.getElementById('imageFileInput');
  const multipleFileInput = document.getElementById('multipleImageFileInput');
  const imagePreview = document.getElementById('imagePreview');
  const multipleImagePreview = document.getElementById('multipleImagePreview');
  const cancelBtn = document.getElementById('cancelImageUpload');
  const applyBtn = document.getElementById('applyImageUpload');
  
  // æ¸…ç©ºæ–‡ä»¶è¾“å…¥å’Œé¢„è§ˆ
  singleFileInput.value = '';
  multipleFileInput.value = '';
  imagePreview.innerHTML = '';
  multipleImagePreview.innerHTML = '';
  v.selectedSingleFile = null;
  v.selectedMultipleFiles = null;
  
  // ç§»é™¤ä¹‹å‰çš„å›¾ç‰‡é¢„è§ˆåŒºåŸŸ
  const oldDivPreview = document.getElementById('divImagesPreview');
  if (oldDivPreview) {
    oldDivPreview.remove();
  }
  
  // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©å™¨
  const oldSelector = document.getElementById('carousel-image-selector');
  if (oldSelector) {
    oldSelector.remove();
  }
  
  // æ ¹æ®ç¼–è¾‘ç±»å‹è®¾ç½®æè¿°å’Œæ˜¾ç¤º/éšè—å…ƒç´ 
  if (v.currentEditingType === 'single') {
    description.textContent = 'é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ æ›¿æ¢å½“å‰å›¾ç‰‡ã€‚';
    uploadTypeToggle.style.display = 'none';
    singleFileInput.style.display = 'block';
    multipleFileInput.style.display = 'none';
    imagePreview.style.display = 'block';
    multipleImagePreview.style.display = 'none';
  } else if (v.currentEditingType === 'background') {
    description.textContent = 'é€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ æ›¿æ¢å½“å‰èƒŒæ™¯å›¾ç‰‡ã€‚';
    uploadTypeToggle.style.display = 'none';
    singleFileInput.style.display = 'block';
    multipleFileInput.style.display = 'none';
    imagePreview.style.display = 'block';
    multipleImagePreview.style.display = 'none';
  } else if (v.currentEditingType === 'carousel' || v.currentEditingType === 'container') {
    let containerType = v.currentEditingType === 'carousel' ? 'è½®æ’­å›¾' : 'åŒºåŸŸ';
    let title = document.querySelector('.modal-title');
    title.textContent = `ä¸Šä¼ å›¾ç‰‡æ›¿æ¢${containerType}å†…å®¹`;
    
    description.textContent = `é€‰æ‹©å›¾ç‰‡ä¸Šä¼ æ›¿æ¢${containerType}ä¸­çš„å›¾ç‰‡ï¼ˆå…±æœ‰${v.containerImages.length}å¼ å›¾ç‰‡ï¼‰ã€‚`;
    uploadTypeToggle.style.display = 'block';
    
    // éªŒè¯containerImagesæ˜¯å¦æ­£ç¡®
    console.log(`[DEBUG] å‡†å¤‡æ›¿æ¢çš„å›¾ç‰‡æ•°é‡: ${v.containerImages.length}`);
    
    // é»˜è®¤é€‰æ‹©å¤šå¼ ä¸Šä¼ æ¨¡å¼ï¼Œæ›´ç¬¦åˆæ‰¹é‡æ›¿æ¢çš„åœºæ™¯
    document.querySelector('input[name="uploadType"][value="multiple"]').checked = true;
    singleFileInput.style.display = 'none';
    multipleFileInput.style.display = 'block';
    imagePreview.style.display = 'none';
    multipleImagePreview.style.display = 'block';
    
    // åˆ›å»ºå›¾ç‰‡é€‰æ‹©å™¨ - ä»…åœ¨å•å¼ æ¨¡å¼ä¸‹æ‰éœ€è¦
    createImageSelector(v.containerImages);
    
    // æ˜¾ç¤ºdivä¸­çš„æ‰€æœ‰å›¾ç‰‡é¢„è§ˆ
    const divPreview = document.createElement('div');
    divPreview.id = 'divImagesPreview';
    divPreview.style.marginBottom = '15px';
    divPreview.style.border = '1px solid #ddd';
    divPreview.style.borderRadius = '4px';
    divPreview.style.padding = '10px';
    
    const previewTitle = document.createElement('h4');
    previewTitle.textContent = `${containerType}ä¸­çš„å›¾ç‰‡:`;
    previewTitle.style.margin = '0 0 10px 0';
    divPreview.appendChild(previewTitle);
    
    const imagesWrapper = document.createElement('div');
    imagesWrapper.style.display = 'flex';
    imagesWrapper.style.flexWrap = 'wrap';
    imagesWrapper.style.gap = '10px';
    
    v.containerImages.forEach((img, index) => {
      const imgContainer = document.createElement('div');
      imgContainer.style.textAlign = 'center';
      
      const imgEl = document.createElement('img');
      imgEl.src = img.src;
      imgEl.style.maxHeight = '80px';
      imgEl.style.maxWidth = '120px';
      imgEl.style.objectFit = 'contain';
      imgEl.style.border = '1px solid #eee';
      
      const imgLabel = document.createElement('div');
      imgLabel.textContent = `å›¾ç‰‡ ${index + 1}`;
      imgLabel.style.fontSize = '12px';
      imgLabel.style.marginTop = '5px';
      
      imgContainer.appendChild(imgEl);
      imgContainer.appendChild(imgLabel);
      imagesWrapper.appendChild(imgContainer);
    });
    
    divPreview.appendChild(imagesWrapper);
    
    // åœ¨æ¨¡æ€æ¡†çš„æè¿°ä¸‹æ–¹æ·»åŠ å›¾ç‰‡é¢„è§ˆ
    description.parentNode.insertBefore(divPreview, description.nextSibling);
  }
  
  // æ˜¾ç¤ºæ¨¡æ€æ¡†
  modal.style.display = 'flex';
  
  // ç»‘å®šäº‹ä»¶
  cancelBtn.onclick = closeImageUploadModal;
  applyBtn.onclick = applyImageUpload;
  
  // å•ä¸ªæ–‡ä»¶è¾“å…¥å˜åŒ–äº‹ä»¶
  singleFileInput.onchange = function(e) {
    const file = e.target.files[0];
    if (file) {
      v.selectedSingleFile = file;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        imagePreview.innerHTML = '';
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.maxHeight = '200px';
        img.style.marginBottom = '10px';
        imagePreview.appendChild(img);
        
        // æ˜¾ç¤ºæ›¿æ¢ä¿¡æ¯
        const info = document.createElement('p');
        
        if (v.currentEditingType === 'single' && v.currentEditingImage) {
          const originalSrc = v.currentEditingImage.src.split('/').pop();
          info.innerHTML = `å°†æ›¿æ¢: <strong>${originalSrc}</strong> â†’ <strong>${file.name}</strong>`;
        } else if (v.currentEditingType === 'background') {
          const bgUrl = getBackgroundImageUrl(v.currentEditingElement);
          const originalSrc = bgUrl ? bgUrl.split('/').pop() : 'èƒŒæ™¯å›¾';
          info.innerHTML = `å°†æ›¿æ¢èƒŒæ™¯å›¾: <strong>${originalSrc}</strong> â†’ <strong>${file.name}</strong>`;
        } else if ((v.currentEditingType === 'carousel' || v.currentEditingType === 'container') && v.selectedImageIndex >= 0) {
          const originalImg = v.containerImages[v.selectedImageIndex];
          const originalSrc = originalImg.src.split('/').pop();
          info.innerHTML = `å°†æ›¿æ¢ç¬¬ ${v.selectedImageIndex + 1} å¼ å›¾ç‰‡: <strong>${originalSrc}</strong> â†’ <strong>${file.name}</strong>`;
        }
        
        imagePreview.appendChild(info);
      };
      
      reader.readAsDataURL(file);
    }
  };
  
  // å¤šä¸ªæ–‡ä»¶è¾“å…¥å˜åŒ–äº‹ä»¶
  multipleFileInput.onchange = function(e) {
    const files = e.target.files;
    if (files && files.length > 0) {
      v.selectedMultipleFiles = files;
      
      multipleImagePreview.innerHTML = '';
      
      // æ£€æŸ¥æ–‡ä»¶æ•°é‡
      if (files.length > v.containerImages.length) {
        const warning = document.createElement('p');
        warning.style.color = 'red';
        warning.textContent = `è­¦å‘Š: æ‚¨é€‰æ‹©äº†${files.length}å¼ å›¾ç‰‡ï¼Œä½†${v.currentEditingType === 'carousel' ? 'è½®æ’­å›¾' : 'åŒºåŸŸ'}ä¸­åªæœ‰${v.containerImages.length}å¼ å›¾ç‰‡ã€‚åªæœ‰å‰${v.containerImages.length}å¼ å°†è¢«ä½¿ç”¨ã€‚`;
        multipleImagePreview.appendChild(warning);
      }
      
      // æ˜¾ç¤ºæ›¿æ¢é¢„è§ˆ
      const previewContainer = document.createElement('div');
      previewContainer.style.display = 'flex';
      previewContainer.style.flexDirection = 'column';
      previewContainer.style.gap = '15px';
      
      const maxToShow = Math.min(files.length, v.containerImages.length);
      
      // æ·»åŠ æ ‡é¢˜
      const title = document.createElement('h4');
      title.textContent = 'æ›¿æ¢é¢„è§ˆ:';
      title.style.margin = '10px 0';
      previewContainer.appendChild(title);
      
      for (let i = 0; i < maxToShow; i++) {
        const file = files[i];
        const originalImg = v.containerImages[i];
        
        const itemContainer = document.createElement('div');
        itemContainer.style.width = '100%';
        itemContainer.style.padding = '10px';
        itemContainer.style.border = '1px solid #ddd';
        itemContainer.style.borderRadius = '4px';
        itemContainer.style.backgroundColor = '#f9f9f9';
        
        const originalSrc = originalImg.src.split('/').pop();
        
        const reader = new FileReader();
        reader.onload = (function(index, origSrc, f) {
          return function(e) {
            const content = `
              <div style="display: flex; align-items: center; gap: 15px;">
                <div style="flex: 1; text-align: center;">
                  <img src="${originalImg.src}" style="max-height: 100px; max-width: 100%; border: 1px solid #ddd;">
                  <p style="margin: 5px 0 0 0; font-size: 12px; font-weight: bold;">${origSrc}</p>
                </div>
                <div style="font-size: 24px; color: #4285f4;">â†’</div>
                <div style="flex: 1; text-align: center;">
                  <img src="${e.target.result}" style="max-height: 100px; max-width: 100%; border: 1px solid #ddd;">
                  <p style="margin: 5px 0 0 0; font-size: 12px; font-weight: bold;">${f.name}</p>
                </div>
              </div>
              <p style="margin: 10px 0 0 0; text-align: center; background-color: #e8f0fe; padding: 5px; border-radius: 4px;">
                æ›¿æ¢ç¬¬ ${index + 1} å¼ å›¾ç‰‡
              </p>
            `;
            
            itemContainer.innerHTML = content;
          };
        })(i, originalSrc, file);
        
        reader.readAsDataURL(file);
        previewContainer.appendChild(itemContainer);
      }
      
      multipleImagePreview.appendChild(previewContainer);
    }
  };
  
  // ä¸Šä¼ ç±»å‹åˆ‡æ¢
  const radioButtons = document.querySelectorAll('input[name="uploadType"]');
  radioButtons.forEach(radio => {
    radio.onchange = function() {
      if (this.value === 'single') {
        singleFileInput.style.display = 'block';
        multipleFileInput.style.display = 'none';
        imagePreview.style.display = 'block';
        multipleImagePreview.style.display = 'none';
        
        // æ˜¾ç¤ºå›¾ç‰‡é€‰æ‹©å™¨
        const selector = document.getElementById('carousel-image-selector');
        if (selector) selector.style.display = 'block';
        
        // æ¸…ç©ºå·²é€‰æ–‡ä»¶
        multipleFileInput.value = '';
        multipleImagePreview.innerHTML = '';
        v.selectedMultipleFiles = null;
      } else {
        singleFileInput.style.display = 'none';
        multipleFileInput.style.display = 'block';
        imagePreview.style.display = 'none';
        multipleImagePreview.style.display = 'block';
        
        // éšè—å›¾ç‰‡é€‰æ‹©å™¨
        const selector = document.getElementById('carousel-image-selector');
        if (selector) selector.style.display = 'none';
        
        // æ¸…ç©ºå·²é€‰æ–‡ä»¶
        singleFileInput.value = '';
        imagePreview.innerHTML = '';
        v.selectedSingleFile = null;
      }
    };
  });
  
  // å¦‚æœæ˜¯å¤šå¼ ä¸Šä¼ æ¨¡å¼ï¼Œè§¦å‘changeäº‹ä»¶ä»¥åˆå§‹åŒ–ç•Œé¢
  if (v.currentEditingType === 'carousel' || v.currentEditingType === 'container') {
    document.querySelector('input[name="uploadType"]:checked').dispatchEvent(new Event('change'));
  }
}

// åˆ›å»ºè½®æ’­å›¾é€‰æ‹©å™¨
function createImageSelector(images) {
  if (!images || images.length === 0) return;
  
  const v = window.editorVars;
  const imagePreview = document.getElementById('imagePreview');
  
  // æ¸…ç©ºé€‰æ‹©å™¨
  const existingSelector = document.getElementById('carousel-image-selector');
  if (existingSelector) {
    existingSelector.remove();
  }
  
  // åˆ›å»ºé€‰æ‹©å™¨å®¹å™¨
  const selectorContainer = document.createElement('div');
  selectorContainer.id = 'carousel-image-selector';
  selectorContainer.style.marginBottom = '15px';
  
  // æ·»åŠ æ ‡é¢˜
  const title = document.createElement('p');
  title.textContent = 'é€‰æ‹©è¦æ›¿æ¢çš„å›¾ç‰‡:';
  selectorContainer.appendChild(title);
  
  // åˆ›å»ºå›¾ç‰‡é€‰æ‹©åŒº
  const selector = document.createElement('div');
  selector.style.display = 'flex';
  selector.style.flexWrap = 'wrap';
  selector.style.gap = '10px';
  
  // æ·»åŠ å›¾ç‰‡é€‰é¡¹
  images.forEach((img, index) => {
    const option = document.createElement('div');
    option.style.border = '2px solid transparent';
    option.style.padding = '5px';
    option.style.cursor = 'pointer';
    option.style.borderRadius = '4px';
    option.dataset.index = index;
    
    const thumbnail = document.createElement('img');
    thumbnail.src = img.src;
    thumbnail.style.height = '60px';
    thumbnail.style.maxWidth = '100px';
    thumbnail.style.objectFit = 'contain';
    
    const label = document.createElement('div');
    label.textContent = `å›¾ç‰‡ ${index + 1}`;
    label.style.fontSize = '12px';
    label.style.textAlign = 'center';
    label.style.marginTop = '5px';
    
    option.appendChild(thumbnail);
    option.appendChild(label);
    
    // ç‚¹å‡»äº‹ä»¶
    option.onclick = function() {
      // ç§»é™¤æ‰€æœ‰é€‰ä¸­æ ·å¼
      selector.querySelectorAll('div[data-index]').forEach(el => {
        el.style.border = '2px solid transparent';
        el.style.backgroundColor = 'transparent';
      });
      
      // è®¾ç½®é€‰ä¸­æ ·å¼
      this.style.border = '2px solid #4285f4';
      this.style.backgroundColor = 'rgba(66, 133, 244, 0.1)';
      
      // ä¿å­˜é€‰ä¸­çš„ç´¢å¼•
      v.selectedImageIndex = parseInt(this.dataset.index);
      
      // æ¸…ç©ºå·²é€‰æ–‡ä»¶
      document.getElementById('imageFileInput').value = '';
      imagePreview.innerHTML = '';
      v.selectedSingleFile = null;
    };
    
    selector.appendChild(option);
  });
  
  // æ·»åŠ é€‰æ‹©å™¨åˆ°å®¹å™¨
  selectorContainer.appendChild(selector);
  
  // æ’å…¥åˆ°æ¨¡æ€æ¡†ä¸­
  const uploadTypeToggle = document.getElementById('uploadTypeToggle');
  uploadTypeToggle.parentNode.insertBefore(selectorContainer, uploadTypeToggle.nextSibling);
  
  // é»˜è®¤é€‰æ‹©ç¬¬ä¸€å¼ å›¾ç‰‡
  selector.querySelector('div[data-index="0"]').click();
}

// å…³é—­å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡†
function closeImageUploadModal() {
  const modal = document.getElementById('imageUploadModal');
  if (modal) {
    modal.style.display = 'none';
  }
  
  // æ¸…ç©ºä¸´æ—¶å˜é‡
  const v = window.editorVars;
  v.selectedSingleFile = null;
  v.selectedMultipleFiles = null;
  
  // ç§»é™¤é€‰æ‹©å™¨
  const selector = document.getElementById('carousel-image-selector');
  if (selector) {
    selector.remove();
  }
}

// åº”ç”¨å›¾ç‰‡ä¸Šä¼ äº‹ä»¶
function applyImageUpload() {
  const v = window.editorVars;
  const imageFileInput = document.getElementById('imageFileInput');
  const multipleImageFileInput = document.getElementById('multipleImageFileInput');
  
  // è·å–é€‰ä¸­çš„å•é€‰æŒ‰é’®
  const uploadType = document.querySelector('input[name="uploadType"]:checked')?.value || 'single';
  
  // éªŒè¯æ˜¯å¦æœ‰é€‰æ‹©æ–‡ä»¶
  if (uploadType === 'single') {
    // ä½¿ç”¨v.selectedSingleFileè€Œä¸æ˜¯æ£€æŸ¥æ–‡ä»¶è¾“å…¥ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨onchangeä¸­è®¾ç½®äº†å®ƒ
    if (!v.selectedSingleFile) {
      alert('è¯·é€‰æ‹©å›¾ç‰‡');
      return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
      if (v.currentEditingType === 'single' && v.currentEditingImage) {
        // ä¿å­˜åŸå§‹å›¾ç‰‡è·¯å¾„
        const originalSrc = v.currentEditingImage.src;
        // æ›´æ–°å›¾ç‰‡
        v.currentEditingImage.src = e.target.result;
        console.log(`å·²æˆåŠŸæ›¿æ¢å›¾ç‰‡: ${originalSrc} -> ${v.selectedSingleFile.name}`);
        
        // ä¿å­˜ç¼–è¾‘çš„å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
        saveEditedImage(originalSrc, v.selectedSingleFile);
      } else if (v.currentEditingType === 'background') {
        // æ›´æ–°èƒŒæ™¯å›¾
        v.currentEditingElement.style.backgroundImage = `url('${e.target.result}')`;
        
        // ä¿å­˜ç¼–è¾‘çš„èƒŒæ™¯å›¾åˆ°æœ¬åœ°å­˜å‚¨
        const bgUrl = getBackgroundImageUrl(v.currentEditingElement);
        saveEditedImage(bgUrl, v.selectedSingleFile);
        
        console.log(`å·²æˆåŠŸæ›¿æ¢èƒŒæ™¯å›¾`);
      } else if ((v.currentEditingType === 'carousel' || v.currentEditingType === 'container') && v.selectedImageIndex >= 0) {
        // ä¿å­˜åŸå§‹å›¾ç‰‡è·¯å¾„
        const originalSrc = v.containerImages[v.selectedImageIndex].src;
        // æ›´æ–°å›¾ç‰‡
        v.containerImages[v.selectedImageIndex].src = e.target.result;
        console.log(`å·²æˆåŠŸæ›¿æ¢ç¬¬ ${v.selectedImageIndex + 1} å¼ å›¾ç‰‡: ${originalSrc} -> ${v.selectedSingleFile.name}`);
        
        // ä¿å­˜ç¼–è¾‘çš„å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
        saveEditedImage(originalSrc, v.selectedSingleFile);
      }
      
      // å…³é—­æ¨¡æ€æ¡†
      closeImageUploadModal();
    };
    
    reader.readAsDataURL(v.selectedSingleFile);
    
  } else if (uploadType === 'multiple') {
    // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„å¤šä¸ªæ–‡ä»¶
    const files = multipleImageFileInput.files;
    
    if (!files || files.length === 0) {
      alert('è¯·é€‰æ‹©å›¾ç‰‡');
      return;
    }
    
    // æ£€æŸ¥é€‰æ‹©çš„å›¾ç‰‡æ•°é‡æ˜¯å¦ä¸å®¹å™¨å›¾ç‰‡æ•°é‡åŒ¹é…
    if (files.length > v.containerImages.length) {
      alert(`æ‚¨é€‰æ‹©äº†${files.length}å¼ å›¾ç‰‡ï¼Œä½†${v.currentEditingType === 'carousel' ? 'è½®æ’­å›¾' : 'åŒºåŸŸ'}ä¸­åªæœ‰${v.containerImages.length}å¼ å›¾ç‰‡ï¼Œåªä¼šä½¿ç”¨å‰${v.containerImages.length}å¼ å›¾ç‰‡`);
    }
    
    // å¤„ç†å¤šå¼ å›¾ç‰‡ä¸Šä¼ 
    let processedCount = 0;
    for (let i = 0; i < Math.min(files.length, v.containerImages.length); i++) {
      const file = files[i];
      const reader = new FileReader();
      
      reader.onload = (function(index) {
        return function(e) {
          // ä¿å­˜åŸå§‹å›¾ç‰‡è·¯å¾„
          const originalSrc = v.containerImages[index].src;
          // æ›´æ–°å›¾ç‰‡
          v.containerImages[index].src = e.target.result;
          console.log(`å·²æˆåŠŸæ›¿æ¢å›¾ç‰‡ ${index + 1}: ${originalSrc} -> ${files[index].name}`);
          
          // ä¿å­˜ç¼–è¾‘çš„å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
          saveEditedImage(originalSrc, files[index]);
          
          processedCount++;
          // å¦‚æœæ‰€æœ‰å›¾ç‰‡éƒ½å¤„ç†å®Œæ¯•ï¼Œå…³é—­æ¨¡æ€æ¡†
          if (processedCount === Math.min(files.length, v.containerImages.length)) {
            closeImageUploadModal();
          }
        };
      })(i);
      
      reader.readAsDataURL(file);
    }
  }
}

// è·å–èƒŒæ™¯å›¾URL
function getBackgroundImageUrl(element) {
  if (!element) return null;
  
  const bgImage = window.getComputedStyle(element).backgroundImage;
  if (bgImage && bgImage !== 'none') {
    // æå–urlä¸­çš„å®é™…é“¾æ¥
    const match = bgImage.match(/url\(['"]?(.*?)['"]?\)/);
    if (match && match[1]) {
      return match[1];
    }
  }
  
  return null;
}

// åˆå§‹åŒ–ç¼–è¾‘å™¨
document.addEventListener('DOMContentLoaded', function() {
  console.log('åˆå§‹åŒ–ç¼–è¾‘å™¨...');
  initEditor();
});

function makeElementEditable(root) {
  console.log('[DEBUG] ä½¿å…ƒç´ å¯ç¼–è¾‘:', root ? root.tagName : 'null');
  
  if (!root) {
    console.error('[ERROR] æ— æ³•ä½¿ç©ºå…ƒç´ å¯ç¼–è¾‘');
    return;
  }
  
  // è·å–æ‰€æœ‰æ–‡æœ¬å…ƒç´ 
  const textElements = root.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, div > strong, div > em, div > u, li, td, th, button, a');
  console.log('[DEBUG] æ‰¾åˆ°æ–‡æœ¬å…ƒç´ æ•°é‡:', textElements.length);
  
  // ä¿å­˜å…ƒç´ åŸå§‹æ ·å¼ä»¥ä¾¿æ¢å¤
  const originalStyles = new Map();
  
  textElements.forEach(el => {
    // æ’é™¤å·²ç»æ˜¯å¯ç¼–è¾‘çš„å…ƒç´ æˆ–ç¼–è¾‘å™¨è‡ªèº«çš„å…ƒç´ 
    if (el.contentEditable === 'true' || 
        el.classList.contains('editor-button') ||
        el.id === 'elementInspector' ||
        el.id === 'imageUploadModal' ||
        el.id === 'divEditorButtons' ||
        el.parentElement && (
          el.parentElement.id === 'elementInspector' ||
          el.parentElement.id === 'imageUploadModal' ||
          el.parentElement.id === 'divEditorButtons' ||
          el.parentElement.classList.contains('editor-button')
        )) {
      return;
    }
    
    // æ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«å®é™…æ–‡æœ¬å†…å®¹ï¼ˆæ’é™¤ç©ºç™½å†…å®¹æˆ–åªåŒ…å«HTMLå…ƒç´ çš„æƒ…å†µï¼‰
    const text = el.textContent.trim();
    if (!text) {
      return; // è·³è¿‡æ²¡æœ‰æ–‡æœ¬å†…å®¹çš„å…ƒç´ 
    }
    
    // è·³è¿‡åŒ…å«å¤§é‡å­å…ƒç´ ä½†è‡ªèº«æ–‡æœ¬å†…å®¹å¾ˆå°‘çš„å…ƒç´ ï¼ˆå¯èƒ½æ˜¯å®¹å™¨è€Œéæ–‡æœ¬å…ƒç´ ï¼‰
    if (el.children.length > 5 && el.childNodes.length > 10 && text.length < 20) {
      return;
    }
    
    // è·³è¿‡åŒ…å«è¡¨å•å…ƒç´ çš„å…ƒç´ 
    if (el.querySelector('input, select, textarea, button')) {
      return;
    }
    
    try {
      // ç¡®ä¿å…ƒç´ æ˜¯ç›¸å¯¹å®šä½ï¼Œä»¥æ”¯æŒä¼ªå…ƒç´ 
      ensureRelativePosition(el);
      
      // ä½¿å…ƒç´ å¯ç¼–è¾‘ï¼Œä¸ä¿®æ”¹å…¶å¸ƒå±€
      el.contentEditable = 'true';
      el.classList.add('text-editable');
      
      // æ·»åŠ è¾“å…¥äº‹ä»¶å¤„ç†
      el.addEventListener('input', function() {
        // ä¿å­˜ç¼–è¾‘åçš„æ–‡æœ¬
        const v = window.editorVars;
        const path = getElementPath(this);
        v.editedTextElements[path] = this.innerHTML;
        localStorage.setItem('editedTexts', JSON.stringify(v.editedTextElements));
        
        // æ›´æ–°é¡µé¢ä¿®æ”¹æ—¶é—´
        savePageState();
      });
      
      // æ·»åŠ ç„¦ç‚¹äº‹ä»¶å¤„ç†
      el.addEventListener('focus', function() {
        this.dataset.originalText = this.innerHTML;
      });
      
      el.addEventListener('blur', function() {
        // å¦‚æœæ–‡æœ¬å·²æ›´æ”¹ï¼Œè®°å½•æ›´æ”¹
        if (this.dataset.originalText !== this.innerHTML) {
          console.log('[DEBUG] æ–‡æœ¬å·²æ›´æ”¹:', this.innerHTML);
        }
      });
    } catch (error) {
      console.error('[ERROR] ä½¿å…ƒç´ å¯ç¼–è¾‘å¤±è´¥:', error);
    }
  });
  
  // ä¿å­˜åŸå§‹æ ·å¼ä»¥ä¾¿ç¨åæ¢å¤
  window.editorVars.originalTextStyles = originalStyles;
  
  console.log('[DEBUG] æ–‡æœ¬ç¼–è¾‘å·²å¯ç”¨');
}

// ç§»é™¤æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½
function removeTextEditability() {
  console.log('[DEBUG] ç§»é™¤æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½');
  
  // è·å–æ‰€æœ‰å¯ç¼–è¾‘çš„æ–‡æœ¬å…ƒç´ ï¼ˆåŒ…æ‹¬å¯èƒ½é—æ¼çš„å…ƒç´ ï¼‰
  const editableElements = document.querySelectorAll('[contenteditable="true"], .text-editable');
  console.log('[DEBUG] æ‰¾åˆ°å¯ç¼–è¾‘æ–‡æœ¬å…ƒç´ æ•°é‡:', editableElements.length);
  
  editableElements.forEach(el => {
    try {
      // ç§»é™¤å¯ç¼–è¾‘å±æ€§
      el.contentEditable = 'false';
      el.classList.remove('text-editable');
      
      // æ¸…é™¤æ‰€æœ‰æ ·å¼ä¿®æ”¹
      el.style.outline = '';
      el.style.border = '';
      el.style.padding = '';
      el.style.margin = '';
      el.style.cursor = '';
      el.style.backgroundColor = '';
      
      // ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
      const clone = el.cloneNode(true);
      if (el.parentNode) {
        el.parentNode.replaceChild(clone, el);
      }
      
      // ç¡®ä¿å…‹éš†åçš„å…ƒç´ ä¹Ÿä¸æ˜¯å¯ç¼–è¾‘çš„
      clone.contentEditable = 'false';
      clone.removeAttribute('contenteditable');
    } catch (error) {
      console.error('[ERROR] ç§»é™¤æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½å¤±è´¥:', error);
    }
  });
  
  // å¼ºåˆ¶å…¨å±€æ¸…é™¤
  document.querySelectorAll('[contenteditable], [style*="outline"], [style*="border"]').forEach(el => {
    // æ’é™¤ç¼–è¾‘å™¨è‡ªèº«çš„å…ƒç´ 
    if (el.id === 'elementInspector' || 
        el.classList.contains('editor-button') ||
        el.id === 'imageUploadModal' ||
        el.id === 'divEditorButtons' ||
        el.closest('#imageUploadModal')) {
      return;
    }
    
    el.removeAttribute('contenteditable');
    el.contentEditable = 'false';
    
    // æ£€æŸ¥å¹¶æ¸…é™¤å¯èƒ½å½±å“å¸ƒå±€çš„æ ·å¼
    if (el.getAttribute('style') && 
        (el.getAttribute('style').includes('outline') || 
         el.getAttribute('style').includes('border') || 
         el.getAttribute('style').includes('margin') || 
         el.getAttribute('style').includes('padding'))) {
      el.style.outline = '';
      el.style.border = '';
      el.style.padding = '';
      el.style.margin = '';
    }
  });
  
  console.log('[DEBUG] æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½å·²ç§»é™¤');
}

// åº”ç”¨ä¿å­˜çš„æ–‡æœ¬ç¼–è¾‘
function applyTextEdits() {
  const v = window.editorVars;
  console.log('[DEBUG] åº”ç”¨ä¿å­˜çš„æ–‡æœ¬ç¼–è¾‘');
  
  try {
    // éå†æ‰€æœ‰ä¿å­˜çš„æ–‡æœ¬ç¼–è¾‘
    for (const path in v.editedTextElements) {
      try {
        // æŸ¥æ‰¾å…ƒç´ 
        const elements = document.querySelectorAll(path);
        if (elements && elements.length > 0) {
          // æ›´æ–°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ çš„å†…å®¹
          elements[0].innerHTML = v.editedTextElements[path];
          console.log('[DEBUG] å·²æ›´æ–°æ–‡æœ¬å…ƒç´ :', path);
        } else {
          console.warn('[WARN] æ‰¾ä¸åˆ°è·¯å¾„å¯¹åº”çš„å…ƒç´ :', path);
        }
      } catch (error) {
        console.error('[ERROR] åº”ç”¨æ–‡æœ¬ç¼–è¾‘å¤±è´¥:', error, path);
      }
    }
  } catch (error) {
    console.error('[ERROR] åº”ç”¨ä¿å­˜çš„æ–‡æœ¬ç¼–è¾‘å¤±è´¥:', error);
  }
}

// å¤„ç†å…ƒç´ ç‚¹å‡»äº‹ä»¶
function handleElementClick(e) {
  const v = window.editorVars;
  console.log('[DEBUG] å¤„ç†å…ƒç´ ç‚¹å‡»äº‹ä»¶');
  
  if (!v.isEditMode) {
    console.log('[DEBUG] ç¼–è¾‘æ¨¡å¼æœªå¯ç”¨ï¼Œä¸å¤„ç†ç‚¹å‡»');
    return;
  }
  
  // é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶å†’æ³¡
  e.preventDefault();
  e.stopPropagation();
  
  // ç¡®ä¿é«˜äº®å…ƒç´ å­˜åœ¨
  ensureHighlightElementsCreated();
  
  // å¦‚æœç‚¹å‡»çš„æ˜¯ç¼–è¾‘å™¨å…ƒç´ ï¼Œä¸åšä»»ä½•å¤„ç†
  if (e.target.id === 'elementInspector' || 
      e.target.id === 'divEditorButtons' || 
      e.target.classList.contains('element-highlight') || 
      e.target.classList.contains('editor-button') ||
      e.target === document.getElementById('editDuplicateBtn') ||
      e.target === document.getElementById('editRemoveBtn')) {
    console.log('[DEBUG] ç‚¹å‡»çš„æ˜¯ç¼–è¾‘å™¨å…ƒç´ ï¼Œå¿½ç•¥');
    return;
  }
  
  // è·å–ç‚¹å‡»çš„div
  const clickedElement = e.currentTarget;
  console.log('[DEBUG] ç‚¹å‡»çš„å…ƒç´ :', clickedElement.tagName);
  
  // å¦‚æœå·²ç»æœ‰é€‰ä¸­çš„å…ƒç´ ï¼Œç§»é™¤é€‰ä¸­çŠ¶æ€
  if (v.selectedElement) {
    v.selectedElement.style.border = '';
    v.selectedElement.style.boxShadow = '';
    
    // éšè—ç¼–è¾‘æŒ‰é’®
    const editorButtons = document.getElementById('divEditorButtons');
    if (editorButtons) {
      editorButtons.style.display = 'none';
    }
    
    console.log('[DEBUG] ç§»é™¤å…ˆå‰é€‰ä¸­å…ƒç´ çš„æ ·å¼');
  }
  
  // æ›´æ–°é€‰ä¸­çš„å…ƒç´ 
  if (v.selectedElement === clickedElement) {
    // å¦‚æœå†æ¬¡ç‚¹å‡»åŒä¸€ä¸ªå…ƒç´ ï¼Œå–æ¶ˆé€‰æ‹©
    v.selectedElement = null;
    hideEditorButtons();
    console.log('[DEBUG] å–æ¶ˆé€‰æ‹©å…ƒç´ ');
    return;
  }
  
  // è®¾ç½®æ–°é€‰ä¸­çš„å…ƒç´ 
  v.selectedElement = clickedElement;
  
  // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„å…ƒç´ 
  v.selectedElement.style.border = '2px solid #34a853';
  v.selectedElement.style.boxShadow = '0 0 10px rgba(52, 168, 83, 0.5)';
  
  // æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
  showEditorButtons(v.selectedElement);
  
  console.log('[DEBUG] é€‰ä¸­æ–°å…ƒç´ ï¼Œåº”ç”¨æ ·å¼å’Œæ˜¾ç¤ºæŒ‰é’®');
}

// æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
function showEditorButtons(element) {
  console.log('[DEBUG] æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®');
  if (!element) return;
  
  const buttons = document.getElementById('divEditorButtons');
  if (!buttons) {
    console.error('[ERROR] æ‰¾ä¸åˆ°ç¼–è¾‘æŒ‰é’®å®¹å™¨');
    return;
  }
  
  // è·å–å…ƒç´ ä½ç½®
  const rect = element.getBoundingClientRect();
  
  // è®¾ç½®æŒ‰é’®ä½ç½®åˆ°å³ä¸‹è§’
  buttons.style.display = 'flex';
  buttons.style.position = 'absolute';
  buttons.style.top = (rect.bottom + window.scrollY + 5) + 'px'; // å…ƒç´ åº•éƒ¨ä¸‹æ–¹5px
  buttons.style.left = (rect.right + window.scrollX - 90) + 'px'; // å…ƒç´ å³ä¾§åå·¦90px
  
  console.log('[DEBUG] ç¼–è¾‘æŒ‰é’®å·²æ˜¾ç¤º');
}

// éšè—ç¼–è¾‘æŒ‰é’®
function hideEditorButtons() {
  console.log('[DEBUG] éšè—ç¼–è¾‘æŒ‰é’®');
  const buttons = document.getElementById('divEditorButtons');
  if (buttons) {
    buttons.style.display = 'none';
    console.log('[DEBUG] ç¼–è¾‘æŒ‰é’®å·²éšè—');
  }
}

// å¤åˆ¶å…ƒç´ 
function duplicateElement(element) {
  console.log('[DEBUG] å¤åˆ¶å…ƒç´ ');
  if (!element) return;
  
  try {
    // åˆ›å»ºå…ƒç´ çš„å‰¯æœ¬
    const clone = element.cloneNode(true);
    
    // ç§»é™¤å¯èƒ½çš„IDä»¥é¿å…é‡å¤ID
    if (clone.id) {
      clone.id = clone.id + '-copy';
    }
    
    // æ’å…¥å‰¯æœ¬åˆ°åŸå…ƒç´ ä¹‹å
    if (element.parentNode) {
      element.parentNode.insertBefore(clone, element.nextSibling);
      console.log('[DEBUG] å…ƒç´ å·²æˆåŠŸå¤åˆ¶');
      
      // ä¿å­˜é¡µé¢ä¿®æ”¹çŠ¶æ€
      savePageState();
    }
  } catch (error) {
    console.error('[ERROR] å¤åˆ¶å…ƒç´ å¤±è´¥:', error);
  }
}

// ç§»é™¤å…ƒç´ 
function removeElement(element) {
  console.log('[DEBUG] ç§»é™¤å…ƒç´ ');
  if (!element) return;
  
  try {
    // éšè—ç¼–è¾‘æŒ‰é’®
    hideEditorButtons();
    
    // ç§»é™¤å…ƒç´ ï¼ˆä¸å†éœ€è¦ç¡®è®¤ï¼‰
    if (element.parentNode) {
      element.parentNode.removeChild(element);
      console.log('[DEBUG] å…ƒç´ å·²æˆåŠŸç§»é™¤');
      
      // é‡ç½®é€‰ä¸­çš„å…ƒç´ 
      window.editorVars.selectedElement = null;
      
      // ä¿å­˜é¡µé¢ä¿®æ”¹çŠ¶æ€
      savePageState();
    }
  } catch (error) {
    console.error('[ERROR] ç§»é™¤å…ƒç´ å¤±è´¥:', error);
  }
}

// åº”ç”¨é¡µé¢ä¿®æ”¹
function applyPageModifications() {
  // å®ç°ä¿å­˜çš„é¡µé¢ä¿®æ”¹é€»è¾‘
  console.log('[DEBUG] åº”ç”¨é¡µé¢ä¿®æ”¹');
}

// ä½¿æ‰€æœ‰å›¾ç‰‡å¯ç¼–è¾‘
function makeImagesEditable() {
  console.log('[DEBUG] ä½¿æ‰€æœ‰å›¾ç‰‡å¯ç¼–è¾‘');
  
  // æ¸…é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
  document.querySelectorAll('.image-editable').forEach(img => {
    img.removeEventListener('click', handleImageEditClick);
    img.classList.remove('image-editable');
  });
  
  document.querySelectorAll('.bg-image-editable').forEach(el => {
    el.removeEventListener('click', handleImageEditClick);
    el.classList.remove('bg-image-editable');
    el.removeAttribute('data-bg-editable');
  });
  
  document.querySelectorAll('div').forEach(div => {
    div.removeEventListener('click', handleImageEditClick);
  });
  
  // å¤„ç†æ™®é€šå›¾ç‰‡
  let imageCount = 0;
  document.querySelectorAll('img').forEach(img => {
    // æ’é™¤ç¼–è¾‘å™¨å…ƒç´ çš„å›¾ç‰‡
    if (img.closest('#elementInspector') || 
        img.closest('#divEditorButtons') || 
        img.closest('#imageUploadModal') ||
        img.closest('.editor-button')) {
      return;
    }
    
    // ç¡®ä¿å›¾ç‰‡çˆ¶å…ƒç´ æ˜¯ç›¸å¯¹å®šä½ï¼Œä»¥æ”¯æŒä¼ªå…ƒç´ 
    if (img.parentElement) {
      ensureRelativePosition(img.parentElement);
    }
    
    // ä»…æ·»åŠ ç±»å’Œäº‹ä»¶ç›‘å¬å™¨ï¼Œä¸ä¿®æ”¹ç›´æ¥æ ·å¼
    img.classList.add('image-editable');
    img.addEventListener('click', handleImageEditClick);
    imageCount++;
  });
  
  console.log(`[DEBUG] æ·»åŠ äº† ${imageCount} å¼ å¯ç¼–è¾‘å›¾ç‰‡`);
  
  // å¤„ç†èƒŒæ™¯å›¾ç‰‡
  let bgImageCount = 0;
  document.querySelectorAll('*').forEach(el => {
    // æ’é™¤å·²å¤„ç†çš„å…ƒç´ å’Œç¼–è¾‘å™¨å…ƒç´ 
    if (el.classList.contains('bg-image-editable') || 
        el.id === 'elementInspector' || 
        el.id === 'divEditorButtons' ||
        el.classList.contains('element-highlight') ||
        el.classList.contains('editor-button') ||
        el.closest('#imageUploadModal')) {
      return;
    }
    
    const style = window.getComputedStyle(el);
    const bgImage = style.backgroundImage;
    
    if (bgImage && bgImage !== 'none' && !bgImage.includes('gradient')) {
      // ç¡®ä¿å…ƒç´ æ˜¯ç›¸å¯¹å®šä½ï¼Œä»¥æ”¯æŒä¼ªå…ƒç´ 
      ensureRelativePosition(el);
      
      el.classList.add('bg-image-editable');
      el.setAttribute('data-bg-editable', 'true');
      el.addEventListener('click', handleImageEditClick);
      bgImageCount++;
    }
  });
  
  console.log(`[DEBUG] æ·»åŠ äº† ${bgImageCount} ä¸ªå¯ç¼–è¾‘èƒŒæ™¯`);
  
  // å¤„ç†è½®æ’­å›¾å®¹å™¨
  const carouselContainers = [];
  
  // æŸ¥æ‰¾å¯èƒ½çš„è½®æ’­å›¾å®¹å™¨
  document.querySelectorAll('.carousel, .swiper, .slider, [id*="carousel"], [id*="slider"], [class*="carousel"], [class*="slider"]').forEach(container => {
    // æ’é™¤ç¼–è¾‘å™¨å…ƒç´ 
    if (container.closest('#elementInspector') || 
        container.closest('#divEditorButtons') || 
        container.closest('#imageUploadModal') ||
        container.classList.contains('editor-button')) {
      return;
    }
    
    if (container.querySelectorAll('img').length > 1) {
      carouselContainers.push(container);
    }
  });
  
  console.log(`[DEBUG] æ‰¾åˆ° ${carouselContainers.length} ä¸ªè½®æ’­å›¾`);
  
  // æ ‡è®°è½®æ’­å›¾å®¹å™¨
  carouselContainers.forEach(container => {
    container.classList.add('carousel-container-editable');
    container.setAttribute('data-carousel-editable', 'true');
    container.addEventListener('click', handleImageEditClick);
    
    // æ·»åŠ æç¤ºæ ‡è®°
    if (!container.querySelector('[data-carousel-hint]')) {
      const hint = document.createElement('div');
      hint.setAttribute('data-carousel-hint', 'true');
      hint.style.position = 'absolute';
      hint.style.top = '5px';
      hint.style.right = '5px';
      hint.style.backgroundColor = 'rgba(66, 133, 244, 0.8)';
      hint.style.color = 'white';
      hint.style.padding = '2px 5px';
      hint.style.borderRadius = '3px';
      hint.style.fontSize = '12px';
      hint.style.zIndex = '1000';
      hint.textContent = 'è½®æ’­å›¾ - ç‚¹å‡»ç¼–è¾‘';
      
      // å¦‚æœå®¹å™¨æ˜¯ç›¸å¯¹å®šä½ï¼Œç›´æ¥æ·»åŠ æç¤ºï¼›å¦åˆ™ï¼Œå…ˆè®¾ç½®ç›¸å¯¹å®šä½
      const containerStyle = window.getComputedStyle(container);
      if (containerStyle.position === 'static') {
        container.style.position = 'relative';
      }
      
      container.appendChild(hint);
    }
  });
  
  // å¤„ç†åŒ…å«å›¾ç‰‡çš„divå®¹å™¨ - æ·»åŠ å¯ç‚¹å‡»ç¼–è¾‘åŠŸèƒ½
  let divWithImagesCount = 0;
  document.querySelectorAll('div').forEach(div => {
    // æ’é™¤å·²å¤„ç†çš„å…ƒç´ å’Œç¼–è¾‘å™¨å…ƒç´ 
    if (div.id === 'elementInspector' || 
        div.id === 'divEditorButtons' ||
        div.classList.contains('element-highlight') ||
        div.classList.contains('editor-button') ||
        div.id === 'imageUploadModal' ||
        div.closest('#imageUploadModal')) {
      return;
    }
    
    // æ£€æŸ¥divæ˜¯å¦åŒ…å«å›¾ç‰‡
    const images = div.querySelectorAll('img');
    if (images.length === 0) {
      return; // æ²¡æœ‰å›¾ç‰‡çš„divç›´æ¥è·³è¿‡
    }
    
    // è¿‡æ»¤å‡ºéç¼–è¾‘å™¨çš„å›¾ç‰‡
    const validImages = Array.from(images).filter(img => {
      return !(img.closest('#elementInspector') || 
              img.closest('#divEditorButtons') || 
              img.closest('#imageUploadModal') ||
              img.closest('.editor-button'));
    });
    
    if (validImages.length > 0) {
      // åŠ ä¸Šç‰¹æ®Šæ ‡è®°ç±»ï¼Œæ–¹ä¾¿è°ƒè¯•
      div.classList.add('div-image-container');
      div.setAttribute('data-images-count', validImages.length);
      
      // ç›´æ¥ä½¿ç”¨ç®€å•çš„ç‚¹å‡»å¤„ç†å‡½æ•°
      div.addEventListener('click', function(e) {
        console.log('[DEBUG] divç‚¹å‡»äº‹ä»¶è§¦å‘', this.tagName, 'åŒ…å«å›¾ç‰‡æ•°:', validImages.length);
        // é˜²æ­¢å†’æ³¡
        e.stopPropagation();
        // è°ƒç”¨å¤„ç†å‡½æ•°
        handleImageEditClick.call(this, e);
      });
      
      divWithImagesCount++;
    }
  });
  
  console.log(`[DEBUG] æ·»åŠ äº† ${divWithImagesCount} ä¸ªåŒ…å«å›¾ç‰‡çš„div`);
  
  // å¤„ç†åŒ…å«å¤šä¸ªå›¾ç‰‡çš„é“¾æ¥å®¹å™¨
  document.querySelectorAll('a').forEach(link => {
    const images = link.querySelectorAll('img');
    if (images.length > 0) {
      link.setAttribute('data-image-editable-container', 'true');
    }
  });
  
  console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘å·²å¯ç”¨');
}

// ä¿å­˜ç¼–è¾‘çš„å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
function saveEditedImage(originalSrc, file) {
  const v = window.editorVars;
  
  try {
    // è¯»å–æ–‡ä»¶ä¸ºDataURL
    const reader = new FileReader();
    reader.onload = function(e) {
      const dataUrl = e.target.result;
      
      // æ ¹æ®ç¼–è¾‘ç±»å‹ä¿å­˜åˆ°ä¸åŒçš„å­˜å‚¨å¯¹è±¡
      if (v.currentEditingType === 'single') {
        v.editedImages[originalSrc] = dataUrl;
        localStorage.setItem('editedImages', JSON.stringify(v.editedImages));
      } else if (v.currentEditingType === 'background') {
        v.editedBackgroundImages[originalSrc] = dataUrl;
        localStorage.setItem('editedBackgroundImages', JSON.stringify(v.editedBackgroundImages));
      } else if (v.currentEditingType === 'carousel' || v.currentEditingType === 'container') {
        v.editedCarouselImages[originalSrc] = dataUrl;
        localStorage.setItem('editedCarouselImages', JSON.stringify(v.editedCarouselImages));
      }
      
      // æ›´æ–°é¡µé¢ä¿®æ”¹æ—¶é—´
      savePageState();
      
      console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘å·²ä¿å­˜:', originalSrc);
    };
    
    reader.readAsDataURL(file);
  } catch (error) {
    console.error('[ERROR] ä¿å­˜ç¼–è¾‘çš„å›¾ç‰‡å¤±è´¥:', error);
  }
}

// åº”ç”¨å›¾ç‰‡ç¼–è¾‘
function applyImageEdits() {
  const v = window.editorVars;
  console.log('[DEBUG] åº”ç”¨ä¿å­˜çš„å›¾ç‰‡ç¼–è¾‘');
  
  try {
    // åº”ç”¨æ™®é€šå›¾ç‰‡ç¼–è¾‘
    for (const originalSrc in v.editedImages) {
      document.querySelectorAll(`img[src="${originalSrc}"]`).forEach(img => {
        img.src = v.editedImages[originalSrc];
      });
    }
    
    // åº”ç”¨èƒŒæ™¯å›¾ç‰‡ç¼–è¾‘
    for (const originalSrc in v.editedBackgroundImages) {
      document.querySelectorAll('*').forEach(el => {
        const style = window.getComputedStyle(el);
        const bgImage = style.backgroundImage;
        
        if (bgImage && bgImage.includes(originalSrc)) {
          el.style.backgroundImage = `url('${v.editedBackgroundImages[originalSrc]}')`;
        }
      });
    }
    
    // åº”ç”¨è½®æ’­å›¾/å®¹å™¨å›¾ç‰‡ç¼–è¾‘
    for (const originalSrc in v.editedCarouselImages) {
      document.querySelectorAll(`img[src="${originalSrc}"]`).forEach(img => {
        img.src = v.editedCarouselImages[originalSrc];
      });
    }
    
    console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘å·²åº”ç”¨');
  } catch (error) {
    console.error('[ERROR] åº”ç”¨å›¾ç‰‡ç¼–è¾‘å¤±è´¥:', error);
  }
}

// ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼
function removeEditModeFromDivs() {
  console.log('[DEBUG] ç§»é™¤æ‰€æœ‰DIVçš„ç¼–è¾‘æ¨¡å¼');
  
  // æ¸…é™¤é€‰ä¸­æ ·å¼å’Œäº‹ä»¶ç›‘å¬å™¨
  document.querySelectorAll('div').forEach(div => {
    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨å’Œæ ·å¼
    div.removeEventListener('click', handleElementClick);
    div.style.cursor = '';
    
    // æ¸…é™¤divä¸Šå¯èƒ½çš„é«˜äº®æ ·å¼
    if (div.classList.contains('div-selected')) {
      div.classList.remove('div-selected');
    }
    
    div.style.outline = '';
    div.style.border = '';
    div.style.boxShadow = '';
  });
  
  // é‡ç½®é€‰ä¸­å…ƒç´ 
  if (window.editorVars.selectedElement) {
    window.editorVars.selectedElement.style.outline = '';
    window.editorVars.selectedElement.style.border = '';
    window.editorVars.selectedElement.style.boxShadow = '';
    window.editorVars.selectedElement = null;
  }
  
  // éšè—ç¼–è¾‘æŒ‰é’®
  hideEditorButtons();
  
  // éšè—é«˜äº®
  hideHighlight();
  hideHoverHighlight();
  
  console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼å·²ç§»é™¤');
}

// å¤„ç†å›¾ç‰‡ç¼–è¾‘æ¨¡å¼ä¸‹çš„é¼ æ ‡ç§»åŠ¨äº‹ä»¶
function handleImageEditMouseMove(e) {
  const v = window.editorVars;
  
  if (!v.isImageEditMode) {
    return;
  }
  
  const element = document.elementFromPoint(e.clientX, e.clientY);
  
  // å¿½ç•¥ç¼–è¾‘å™¨è‡ªèº«çš„å…ƒç´ 
  if (element && (
      element.id === 'elementInspector' || 
      element.id === 'divEditorButtons' || 
      element.classList.contains('element-highlight') ||
      element.classList.contains('editor-button') ||
      element === document.getElementById('editDuplicateBtn') ||
      element === document.getElementById('editRemoveBtn') ||
      element.closest('#imageUploadModal'))) {
    hideHoverHighlight();
    return;
  }
  
  // æŸ¥æ‰¾æœ€è¿‘çš„divå…ƒç´ 
  let targetDiv = element;
  while (targetDiv && targetDiv.tagName.toLowerCase() !== 'div' && targetDiv !== document.body) {
    targetDiv = targetDiv.parentElement;
  }
  
  if (!targetDiv || targetDiv === document.body) {
    hideHoverHighlight();
    return;
  }
  
  // æ£€æŸ¥divæ˜¯å¦åŒ…å«å›¾ç‰‡ï¼ˆæ’é™¤ç¼–è¾‘å™¨å…ƒç´ çš„å›¾ç‰‡ï¼‰
  const images = targetDiv.querySelectorAll('img');
  let containsImages = false;
  
  for (const img of images) {
    // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å±äºç¼–è¾‘å™¨å…ƒç´ 
    const isEditorElement = img.closest('#elementInspector') || 
                           img.closest('#divEditorButtons') || 
                           img.closest('#imageUploadModal') ||
                           img.closest('.editor-button');
    if (!isEditorElement) {
      containsImages = true;
      break;
    }
  }
  
  if (!containsImages) {
    hideHoverHighlight();
    return;
  }
  
  // æ›´æ–°å½“å‰æ‚¬åœå…ƒç´ 
  v.hoverElement = targetDiv;
  
  // ç‰¹æ®Šæ ‡è®°ï¼Œæ ‡æ˜æ­¤divå¯ç¼–è¾‘å›¾ç‰‡
  if (!targetDiv.classList.contains('div-hover-highlight')) {
    targetDiv.classList.add('div-hover-highlight');
    targetDiv.style.cursor = 'pointer';
  }
  
  // æ˜¾ç¤ºé«˜äº®
  highlightHoverElement(v.hoverElement);
}

// å…¨å±€æ¸…ç†å‡½æ•° - ç¡®ä¿é€€å‡ºæ‰€æœ‰ç¼–è¾‘æ¨¡å¼åæ²¡æœ‰æ ·å¼æ®‹ç•™
function clearAllEditModes() {
  console.log('[DEBUG] æ¸…ç†æ‰€æœ‰ç¼–è¾‘æ¨¡å¼æ ·å¼æ®‹ç•™');
  
  // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„é«˜äº®å’Œæ ·å¼æ”¹å˜
  document.querySelectorAll('*').forEach(el => {
    // æ’é™¤ç¼–è¾‘å™¨è‡ªèº«çš„å…ƒç´ 
    if (el.id === 'elementInspector' || 
        el.classList.contains('editor-button') ||
        el.id === 'imageUploadModal' ||
        el.id === 'divEditorButtons' ||
        el.closest('#imageUploadModal')) {
      return;
    }
    
    // ç§»é™¤å¯èƒ½çš„ç±»
    if (el.classList.contains('text-editable')) el.classList.remove('text-editable');
    if (el.classList.contains('image-editable')) el.classList.remove('image-editable');
    if (el.classList.contains('bg-image-editable')) el.classList.remove('bg-image-editable');
    if (el.classList.contains('carousel-container-editable')) el.classList.remove('carousel-container-editable');
    if (el.classList.contains('div-selected')) el.classList.remove('div-selected');
    if (el.classList.contains('div-image-container')) el.classList.remove('div-image-container');
    if (el.classList.contains('div-hover-highlight')) el.classList.remove('div-hover-highlight');
    
    // ç§»é™¤å¯èƒ½çš„å±æ€§
    if (el.getAttribute('contenteditable')) el.removeAttribute('contenteditable');
    if (el.getAttribute('data-bg-editable')) el.removeAttribute('data-bg-editable');
    if (el.getAttribute('data-carousel-editable')) el.removeAttribute('data-carousel-editable');
    if (el.getAttribute('data-container-editable')) el.removeAttribute('data-container-editable');
    if (el.getAttribute('data-images-count')) el.removeAttribute('data-images-count');
    
    // æ¸…é™¤å¯èƒ½çš„å†…è”æ ·å¼
    if (el.style) {
      if (el.style.outline) el.style.outline = '';
      if (el.style.border) el.style.border = '';
      if (el.style.boxShadow) el.style.boxShadow = '';
      if (el.style.backgroundColor && el.style.backgroundColor.includes('rgba(')) el.style.backgroundColor = '';
    }
  });
  
  // éšè—æ‰€æœ‰ç¼–è¾‘å™¨UI
  hideEditorButtons();
  hideInspector();
  hideHighlight();
  hideHoverHighlight();
  
  // å…³é—­æ¨¡æ€æ¡†
  closeImageUploadModal();
  
  console.log('[DEBUG] æ‰€æœ‰ç¼–è¾‘æ¨¡å¼æ ·å¼å·²æ¸…ç†');
}

// åˆ‡æ¢æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
buttons.textEditBtn.addEventListener('click', function() {
  // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
  document.removeEventListener('mousemove', handleInspectorMouseMove);
  document.removeEventListener('mousemove', handleMouseMove);
  document.removeEventListener('mousemove', handleImageEditMouseMove);
  
  // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
  clearAllEditModes();
  
  // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
  if (v.isImageEditMode) {
    v.isImageEditMode = false;
    completelyRemoveImageEditability();
    buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
    buttons.imageEditBtn.style.backgroundColor = '#4285f4';
    buttons.imageEditBtn.style.color = '#fff';
  }
  
  if (v.isInspecting) {
    v.isInspecting = false;
    hideInspector();
    hideHighlight();
    buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
    buttons.inspectBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isEditMode) {
    v.isEditMode = false;
    removeEditModeFromDivs();
    buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
    buttons.editBtn.style.backgroundColor = '#4285f4';
  }
  
  v.isTextEditMode = !v.isTextEditMode;
  
  if (v.isTextEditMode) {
    // å¯ç”¨æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
    this.innerText = 'ç¦ç”¨æ–‡æœ¬ç¼–è¾‘';
    this.style.backgroundColor = '#34a853';
    
    // ä½¿æ‰€æœ‰æ–‡æœ¬å…ƒç´ å¯ç¼–è¾‘
    makeElementEditable(document.body);
  } else {
    // ç¦ç”¨æ–‡æœ¬ç¼–è¾‘æ¨¡å¼
    this.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
    this.style.backgroundColor = '#4285f4';
    
    // ç§»é™¤å¯ç¼–è¾‘å±æ€§
    removeTextEditability();
  }
});

// åˆ‡æ¢åŒºåŸŸç¼–è¾‘æ¨¡å¼
buttons.editBtn.addEventListener('click', function(e) {
  console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æŒ‰é’®è¢«ç‚¹å‡»', e.type);
  console.log('[DEBUG] ç‚¹å‡»å‰çŠ¶æ€:', { 
    isEditMode: v.isEditMode,
    isInspecting: v.isInspecting, 
    isTextEditMode: v.isTextEditMode,
    isImageEditMode: v.isImageEditMode
  });
  
  // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
  document.removeEventListener('mousemove', handleInspectorMouseMove);
  document.removeEventListener('mousemove', handleMouseMove);
  document.removeEventListener('mousemove', handleImageEditMouseMove);
  
  // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
  clearAllEditModes();
  
  // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
  if (v.isInspecting) {
    console.log('[DEBUG] å…³é—­å…ƒç´ æ£€æŸ¥æ¨¡å¼');
    v.isInspecting = false;
    hideInspector();
    hideHighlight();
    buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
    buttons.inspectBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isTextEditMode) {
    console.log('[DEBUG] å…³é—­æ–‡æœ¬ç¼–è¾‘æ¨¡å¼');
    v.isTextEditMode = false;
    removeTextEditability();
    buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
    buttons.textEditBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isImageEditMode) {
    console.log('[DEBUG] å…³é—­å›¾ç‰‡ç¼–è¾‘æ¨¡å¼');
    v.isImageEditMode = false;
    completelyRemoveImageEditability();
    buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
    buttons.imageEditBtn.style.backgroundColor = '#4285f4';
    buttons.imageEditBtn.style.color = '#fff';
  }
  
  // åˆ‡æ¢åŒºåŸŸç¼–è¾‘çŠ¶æ€
  v.isEditMode = !v.isEditMode;
  console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åˆ‡æ¢ä¸º:', v.isEditMode);
  
  if (v.isEditMode) {
    console.log('[DEBUG] å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
    this.innerText = 'ç¦ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
    this.style.backgroundColor = '#ea4335';
    
    try {
      // åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼
      console.log('[DEBUG] å°è¯•åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
      applyEditModeToDivs();
      console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åº”ç”¨æˆåŠŸ');
      
      // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
      console.log('[DEBUG] å°è¯•ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶');
      document.addEventListener('mousemove', handleMouseMove);
      console.log('[DEBUG] é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç»‘å®šæˆåŠŸ');
    } catch (error) {
      console.error('[ERROR] åº”ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
    }
  } else {
    console.log('[DEBUG] ç¦ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼');
    this.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
    this.style.backgroundColor = '#4285f4';
    
    try {
      // ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼
      console.log('[DEBUG] å°è¯•ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼');
      removeEditModeFromDivs();
      console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼ç§»é™¤æˆåŠŸ');
      
      // è§£ç»‘é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
      document.removeEventListener('mousemove', handleMouseMove);
      console.log('[DEBUG] é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§£ç»‘æˆåŠŸ');
    } catch (error) {
      console.error('[ERROR] ç§»é™¤åŒºåŸŸç¼–è¾‘æ¨¡å¼å¤±è´¥:', error);
    }
  }
  console.log('[DEBUG] åŒºåŸŸç¼–è¾‘æ¨¡å¼åˆ‡æ¢å®Œæˆ');
});

// åˆ‡æ¢å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
buttons.imageEditBtn.addEventListener('click', function() {
  // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
  document.removeEventListener('mousemove', handleInspectorMouseMove);
  document.removeEventListener('mousemove', handleMouseMove);
  document.removeEventListener('mousemove', handleImageEditMouseMove);
  
  // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
  clearAllEditModes();
  
  // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
  if (v.isTextEditMode) {
    v.isTextEditMode = false;
    removeTextEditability();
    buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
    buttons.textEditBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isInspecting) {
    v.isInspecting = false;
    hideInspector();
    hideHighlight();
    buttons.inspectBtn.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
    buttons.inspectBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isEditMode) {
    v.isEditMode = false;
    removeEditModeFromDivs();
    buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
    buttons.editBtn.style.backgroundColor = '#4285f4';
  }
  
  v.isImageEditMode = !v.isImageEditMode;
  
  if (v.isImageEditMode) {
    // å¯ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
    this.innerText = 'ç¦ç”¨å›¾ç‰‡ç¼–è¾‘';
    this.style.backgroundColor = '#fbbc05';
    this.style.color = '#000';
    
    console.log('[DEBUG] æ­£åœ¨å¯ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼...');
    
    // ä½¿æ‰€æœ‰å›¾ç‰‡å…ƒç´ å¯ç¼–è¾‘
    makeImagesEditable();
    
    // é˜»æ­¢é“¾æ¥ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('a[data-image-editable-container="true"]').forEach(link => {
      link.addEventListener('click', preventLinkClick);
    });
    
    // æ˜¾ç¤ºå®¹å™¨ç¼–è¾‘å›¾æ ‡
    document.querySelectorAll('[data-container-editable="true"] .container-edit-icon').forEach(icon => {
      if (icon) {
        icon.style.display = 'block';
      }
    });
    
    // æ·»åŠ é¼ æ ‡ç§»åŠ¨äº‹ä»¶æ¥é«˜äº®div
    document.addEventListener('mousemove', handleImageEditMouseMove);
    
    console.log('[DEBUG] å›¾ç‰‡ç¼–è¾‘æ¨¡å¼å·²å¯ç”¨ï¼Œå¯ä»¥ç‚¹å‡»divæˆ–å›¾ç‰‡');
  } else {
    // ç¦ç”¨å›¾ç‰‡ç¼–è¾‘æ¨¡å¼
    this.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
    this.style.backgroundColor = '#4285f4';
    this.style.color = '#fff';
    
    // ä½¿ç”¨å¢å¼ºçš„æ¸…ç†å‡½æ•°
    completelyRemoveImageEditability();
    
    // æ¢å¤é“¾æ¥ç‚¹å‡»è¡Œä¸º
    document.querySelectorAll('a[data-image-editable-container="true"]').forEach(link => {
      link.removeEventListener('click', preventLinkClick);
      link.removeAttribute('data-image-editable-container');
    });
    
    // ç§»é™¤é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç›‘å¬
    document.removeEventListener('mousemove', handleImageEditMouseMove);
    
    // éšè—é«˜äº®
    hideHoverHighlight();
    
    // ç§»é™¤æ‰€æœ‰div-hover-highlightç±»
    document.querySelectorAll('.div-hover-highlight').forEach(div => {
      div.classList.remove('div-hover-highlight');
      div.style.cursor = '';
    });
    
    // ç§»é™¤æ‰€æœ‰div-image-containerç±»
    document.querySelectorAll('.div-image-container').forEach(div => {
      div.classList.remove('div-image-container');
      div.removeAttribute('data-images-count');
    });
  }
});

// åˆ‡æ¢å…ƒç´ æ£€æŸ¥æ¨¡å¼
buttons.inspectBtn.addEventListener('click', function(e) {
  console.log('[DEBUG] å…ƒç´ æ£€æŸ¥æŒ‰é’®è¢«ç‚¹å‡»', e.type);
  console.log('[DEBUG] ç‚¹å‡»å‰çŠ¶æ€:', { 
    isInspecting: v.isInspecting,
    isTextEditMode: v.isTextEditMode,
    isImageEditMode: v.isImageEditMode,
    isEditMode: v.isEditMode
  });
  
  // æ¸…é™¤å¯èƒ½çš„æ—§äº‹ä»¶å¤„ç†ç¨‹åº
  document.removeEventListener('mousemove', handleInspectorMouseMove);
  document.removeEventListener('mousemove', handleMouseMove);
  document.removeEventListener('mousemove', handleImageEditMouseMove);
  
  // æ¸…ç†æ‰€æœ‰æ ·å¼æ®‹ç•™
  clearAllEditModes();
  
  // å¦‚æœå…¶ä»–æ¨¡å¼å·²å¼€å¯ï¼Œå…ˆå…³é—­
  if (v.isTextEditMode) {
    console.log('[DEBUG] å…³é—­æ–‡æœ¬ç¼–è¾‘æ¨¡å¼');
    v.isTextEditMode = false;
    removeTextEditability();
    buttons.textEditBtn.innerText = 'å¯ç”¨æ–‡æœ¬ç¼–è¾‘';
    buttons.textEditBtn.style.backgroundColor = '#4285f4';
  }
  
  if (v.isImageEditMode) {
    console.log('[DEBUG] å…³é—­å›¾ç‰‡ç¼–è¾‘æ¨¡å¼');
    v.isImageEditMode = false;
    completelyRemoveImageEditability();
    buttons.imageEditBtn.innerText = 'å¯ç”¨å›¾ç‰‡ç¼–è¾‘';
    buttons.imageEditBtn.style.backgroundColor = '#4285f4';
    buttons.imageEditBtn.style.color = '#fff';
  }
  
  if (v.isEditMode) {
    console.log('[DEBUG] å…³é—­åŒºåŸŸç¼–è¾‘æ¨¡å¼');
    v.isEditMode = false;
    removeEditModeFromDivs();
    buttons.editBtn.innerText = 'å¯ç”¨åŒºåŸŸç¼–è¾‘æ¨¡å¼';
    buttons.editBtn.style.backgroundColor = '#4285f4';
  }
  
  // åˆ‡æ¢æ£€æŸ¥æ¨¡å¼çŠ¶æ€
  v.isInspecting = !v.isInspecting;
  console.log('[DEBUG] æ£€æŸ¥æ¨¡å¼åˆ‡æ¢ä¸º:', v.isInspecting);
  
  if (v.isInspecting) {
    console.log('[DEBUG] å¯ç”¨å…ƒç´ æ£€æŸ¥');
    this.innerText = 'ç¦ç”¨å…ƒç´ æ£€æŸ¥';
    this.style.backgroundColor = '#ea4335';
    
    try {
      // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
      console.log('[DEBUG] å°è¯•ç»‘å®šæ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶');
      document.addEventListener('mousemove', handleInspectorMouseMove);
      console.log('[DEBUG] æ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶ç»‘å®šæˆåŠŸ');
    } catch (error) {
      console.error('[ERROR] ç»‘å®šæ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤±è´¥:', error);
    }
  } else {
    console.log('[DEBUG] ç¦ç”¨å…ƒç´ æ£€æŸ¥');
    this.innerText = 'å¯ç”¨å…ƒç´ æ£€æŸ¥';
    this.style.backgroundColor = '#4285f4';
    
    try {
      // éšè—æ£€æŸ¥å™¨å’Œé«˜äº®
      console.log('[DEBUG] å°è¯•éšè—æ£€æŸ¥å™¨å’Œé«˜äº®');
      hideInspector();
      hideHighlight();
      console.log('[DEBUG] æ£€æŸ¥å™¨å’Œé«˜äº®éšè—æˆåŠŸ');
      
      // è§£ç»‘é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†ç¨‹åº
      document.removeEventListener('mousemove', handleInspectorMouseMove);
      console.log('[DEBUG] æ£€æŸ¥å™¨é¼ æ ‡ç§»åŠ¨äº‹ä»¶è§£ç»‘æˆåŠŸ');
    } catch (error) {
      console.error('[ERROR] éšè—æ£€æŸ¥å™¨æˆ–è§£ç»‘äº‹ä»¶å¤±è´¥:', error);
    }
  }
  console.log('[DEBUG] å…ƒç´ æ£€æŸ¥æ¨¡å¼åˆ‡æ¢å®Œæˆ');
});

// ç¡®ä¿å›¾ç‰‡å…ƒç´ ç›¸å¯¹å®šä½ï¼Œä»¥æ”¯æŒä¼ªå…ƒç´ 
function ensureRelativePosition(element) {
  // è·å–å½“å‰computedæ ·å¼
  const computedStyle = window.getComputedStyle(element);
  
  // åªæœ‰å½“å…ƒç´ ä¸æ˜¯relativeã€absoluteæˆ–fixedæ—¶æ‰è®¾ç½®relative
  if (computedStyle.position === 'static') {
    element.style.position = 'relative';
  }
}
</script>
</body>
</html>